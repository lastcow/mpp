//v.1.3 build 100805
/*
Copyright DHTMLX LTD. http://www.dhtmlx.com
To use this component please contact sales@dhtmlx.com to obtain license
*//*_TOPICS_
 * @0:Initialization
 * @1:Add/delete
 * @2:Lookup
 * @3:Appearance
 * @4:Private
 * @5:Handlers
 * @6:Load/Save data
 * @7:Printing
 *//**
 *  @desc: GanttProjectInfo constructor
 *  @param: id - id of the project
 *  @param: name - name of the project
 *  @param: startDate - start date of the project (JavaScript Date object)
 *  @type:  public
 *  @topic: 0
 */function GanttProjectInfo(e,t,n){this.Id=e;this.Name=t;this.StartDate=n;this.ParentTasks=[]}function GanttTaskInfo(e,t,n,r,i,s){this.Id=e;this.Name=t;this.EST=n;this.Duration=r;this.PercentCompleted=i;this.PredecessorTaskId=s;this.ChildTasks=[];this.ChildPredTasks=[];this.ParentTask=null;this.PredecessorTask=null;this.Project=null;this.nextChildTask=null;this.previousChildTask=null;this.nextParentTask=null;this.previousParentTask=null}function GanttTask(e,t,n){this.isTask=!0;this.Chart=n;this.Project=t;this.TaskInfo=e;this.checkMove=!1;this.checkResize=!1;this.moveChild=!1;this.maxPosXMove=-1;this.minPosXMove=-1;this.maxWidthResize=-1;this.minWidthResize=-1;this.posX=0;this.posY=0;this.MouseX=0;this.taskItemWidth=0;this.isHide=!1;this._heightHideTasks=0;this._isOpen=!0;this.descrTask=null;this.cTaskItem=null;this.cTaskNameItem=null;this.parentTask=null;this.predTask=null;this.childTask=[];this.childPredTask=[];this.nextChildTask=null;this.previousChildTask=null;this.nextParentTask=null;this.previousParentTask=null}function GanttProject(e,t){this.isProject=!0;this.nextProject=null;this.previousProject=null;this.arrTasks=[];this.Project=t;this.Chart=e;this.percentCompleted=0;this.Duration=0;this.descrProject=null;this.projectItem=null;this.projectNameItem=null;this.posY=0;this.posX=0}function GanttChart(){this.Error=new GanttError;this.dhtmlXMLSenderObject=new dhtmlXMLSenderObject(this);this.heightTaskItem=12;this.dayInPixels=24;this.hoursInDay=8;this._showTreePanel=!0;this._showTooltip=!0;this.isShowDescTask=!1;this.isShowDescProject=!1;this.isShowNewProject=!0;this.isEditable=!1;this.isShowConMenu=!1;this.correctError=!1;this.maxWidthPanelNames=150;this.minWorkLength=8;this.paramShowTask=[];this.paramShowProject=[];this.savePath=null;this.loadPath=null;this.divTimeInfo=null;this.divInfo=null;this.panelNames=null;this.panelTime=null;this.oData=null;this.content=null;this.panelErrors=null;this.contextMenu=null;this.hourInPixelsWork=this.dayInPixels/this.hoursInDay;this.hourInPixels=this.dayInPixels/24;this.countDays=0;this.startDate=null;this.initialPos=0;this.contentHeight=0;this.contentWidth=0;this._oDataHeight=0;this.Project=[];this.arrProjects=[];this.xmlLoader=null;this._isIE=!1;this._isFF=!1;this._isOpera=!1;this._isMove=!1;this._isResize=!1;this._isError=!1;this.imgs="codebase/imgs/";this.stylePath="codebase/dhtmlxgantt.css";this.shortMonthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];this.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];this._useShortMonthNames=!0;dhtmlxEventable(this)}function GanttError(){this.catches=[];this._errors=[];this._init();return this}function contextMenu(e){this.Chart=e;this.TabContainer=null;this.MenuPanel=null;this.tabPanel=null;this.arrTabs=[];this.isShow=!1;this.hideDiv=null;this._init()}function contextMenuTab(e,t,n,r,i){this.Id=e;this.arrItems=[];this.TabItemContainer=null;this.Description=t;this.contextMenu=i;this.type=n;this.object=null;this.showObjectInfo=r}function contextMenuTabItem(e,t,n,r){this.Id=e;this.Name=t;this.control=n;this.tab=r}GanttProjectInfo.prototype.deleteTask=function(e){var t=this.getTaskById(e);if(t)if(!t.ParentTask){for(var n=0;n<this.ParentTasks.length;n++)if(this.ParentTasks[n].Id==e){if(this.ParentTasks[n].nextParentTask)if(this.ParentTasks[n].previousParentTask){this.ParentTasks[n].previousParentTask.nextParentTask=this.ParentTasks[n].nextParentTask;this.ParentTasks[n].nextParentTask.previousParentTask=this.ParentTasks[n].previousParentTask}else this.ParentTasks[n].nextParentTask.previousParentTask=null;else this.ParentTasks[n].previousParentTask&&(this.ParentTasks[n].previousParentTask.nextParentTask=null);this.ParentTasks[n]=null;this.ParentTasks.splice(n,1);break}}else{var r=t.ParentTask;for(var n=0;n<r.ChildTasks.length;n++)if(r.ChildTasks[n].Id==e){if(r.ChildTasks[n].nextChildTask)if(r.ChildTasks[n].previousChildTask){r.ChildTasks[n].previousChildTask.nextChildTask=r.ChildTasks[n].nextChildTask;r.ChildTasks[n].nextChildTask.previousChildTask=r.ChildTasks[n].previousChildTask}else r.ChildTasks[n].nextChildTask.previousChildTask=null;else r.ChildTasks[n].previousChildTask&&(r.ChildTasks[n].previousChildTask.nextChildTask=null);r.ChildTasks[n]=null;r.ChildTasks.splice(n,1);break}}};GanttProjectInfo.prototype.addTask=function(e){this.ParentTasks.push(e);e.setProject(this)};GanttProjectInfo.prototype.getTaskById=function(e){for(var t=0;t<this.ParentTasks.length;t++){var n=this.getTaskByIdInTree(this.ParentTasks[t],e);if(n)return n}return null};GanttProjectInfo.prototype.getTaskByIdInTree=function(e,t){if(e.Id==t)return e;for(var n=0;n<e.ChildTasks.length;n++){if(e.ChildTasks[n].Id==t)return e.ChildTasks[n];if(e.ChildTasks[n].ChildTasks.length>0&&e.ChildTasks[n].ChildTasks.length>0){var r=this.getTaskByIdInTree(e.ChildTasks[n],t);if(r)return r}}return null};GanttTaskInfo.prototype.addChildTask=function(e){this.ChildTasks.push(e);e.ParentTask=this};GanttTaskInfo.prototype.setProject=function(e){this.Project=e;for(var t=0;t<this.ChildTasks.length;t++)this.ChildTasks[t].setProject(e)};GanttProject.prototype.checkWidthProjectNameItem=function(){if(this.projectNameItem.offsetWidth+this.projectNameItem.offsetLeft>this.Chart.maxWidthPanelNames){var e=this.projectNameItem.offsetWidth+this.projectNameItem.offsetLeft-this.Chart.maxWidthPanelNames,t=Math.round(e/(this.projectNameItem.offsetWidth/this.projectNameItem.firstChild.length)),n=this.Project.Name.substring(0,this.projectNameItem.firstChild.length-t-3);n+="...";this.projectNameItem.innerHTML=n}};GanttProject.prototype.create=function(){var e=this.Chart.oData.firstChild;this.posX=(this.Project.StartDate-this.Chart.startDate)/36e5*this.Chart.hourInPixels;if(this.previousProject)if(this.previousProject.arrTasks.length>0){var t=this.Chart.getLastChildTask(this.previousProject.arrTasks[this.previousProject.arrTasks.length-1]);this.posY=parseInt(t.cTaskItem[0].style.top)+this.Chart.heightTaskItem+11}else this.posY=parseInt(this.previousProject.projectItem[0].style.top)+this.Chart.heightTaskItem+11;else this.posY=6;if(this.Chart._showTreePanel){var n=this.Chart.panelNames.firstChild;this.projectNameItem=this.createProjectNameItem();n.appendChild(this.projectNameItem);this.checkWidthProjectNameItem()}this.projectItem=[this.createProjectItem(),[]];e.appendChild(this.projectItem[0]);this.Chart.isShowDescProject&&e.appendChild(this.createDescrProject());this.addDayInPanelTime()};GanttChart.prototype.setImagePath=function(e){this.imgs=e};GanttChart.prototype.setStylePath=function(e){this.stylePath=e};GanttChart.prototype.setSavePath=function(e){this.savePath=e};GanttChart.prototype.setLoadPath=function(e){this.loadPath=e};GanttChart.prototype.setCorrectError=function(e){this.correctError=e};GanttChart.prototype.showDescTask=function(e,t){this.isShowDescTask=e;var n=new Array(5);if(this.isShowDescTask){if(t){var r=t.split(",");for(var i=0;i<r.length;i++){var s=this.getParamShowTask(r[i]);n[s]=1}}else n[this.getParamShowTask("")]=1;this.paramShowTask=this.getValueShowTask(n)}};GanttChart.prototype.showDescProject=function(e,t){this.isShowDescProject=e;var n=new Array(4);if(this.isShowDescProject){if(t){var r=t.split(",");for(var i=0;i<r.length;i++){var s=this.getParamShowProject(r[i]);n[s]=1}}else n[this.getParamShowProject("")]=1;this.paramShowProject=this.getValueShowProject(n)}};GanttChart.prototype.showContextMenu=function(e){this.isShowConMenu=e};GanttChart.prototype.setContextMenu=function(e){this.showContextMenu(!0);this.contextMenu=e};GanttChart.prototype.showNewProject=function(e){this.isShowNewProject=e};GanttChart.prototype.getParamShowTask=function(e){switch(e){case"n":return 0;case"d":return 1;case"e":return 2;case"p":return 3;case"s-f":return 4;default:return 0}};GanttChart.prototype.getParamShowProject=function(e){switch(e){case"n":return 0;case"d":return 1;case"s":return 2;case"p":return 3;default:return 0}};GanttChart.prototype.getValueShowTask=function(e){var t=[];for(var n=0;n<e.length;n++)if(e[n])switch(n){case 0:t.push("Name");break;case 1:t.push("Duration");break;case 2:t.push("EST");break;case 3:t.push("PercentComplete");break;case 4:t.push("S-F");break;default:}return t};GanttChart.prototype.getValueShowProject=function(e){var t=[];for(var n=0;n<e.length;n++)if(e[n])switch(n){case 0:t.push("Name");break;case 1:t.push("Duration");break;case 2:t.push("StartDate");break;case 3:t.push("PercentComplete");break;default:}return t};GanttChart.prototype.setEditable=function(e){this.isEditable=e};GanttChart.prototype.showTreePanel=function(e){this._showTreePanel=e};GanttChart.prototype.showTooltip=function(e){this._showTooltip=e};GanttChart.prototype.getProjectById=function(e){for(var t=0;t<this.arrProjects.length;t++)if(this.arrProjects[t].Project.Id==e)return this.arrProjects[t];return null};GanttChart.prototype.getBrowserType=function(){navigator.appName.indexOf("Explorer")!=-1?this._isIE=!0:navigator.userAgent.indexOf("Mozilla")!=-1?this._isFF=!0:navigator.userAgent.indexOf("Opera")!=-1&&(this._isOpera=!0)};GanttChart.prototype.addProject=function(e){this.Project.push(e)};GanttProject.prototype.deleteTask=function(e){var t=this.getTaskById(e);t?this.deleteChildTask(t):this.Chart.Error.throwError("DATA_INSERT_ERROR",30,[e])};GanttChart.prototype.deleteProject=function(e){var t=this.getProjectById(e);if(t){if(t.arrTasks.length>0)while(t.arrTasks.length>0)t.deleteChildTask(t.arrTasks[0]);t.nextProject&&t.shiftNextProject(t,-23);for(var n=0;n<this.Project.length;n++)this.Project[n].Id==t.Project.Id&&this.Project.splice(n,1);if(t.previousProject&&t.nextProject){var r=t.previousProject;r.nextProject=t.nextProject}if(t.previousProject&&!t.nextProject){var r=t.previousProject;r.nextProject=null}if(!t.previousProject&&t.nextProject){var i=t.nextProject;i.previousProject=null}for(var n=0;n<this.arrProjects.length;n++)this.arrProjects[n].Project.Id==e&&this.arrProjects.splice(n,1);t.projectItem[0].parentNode.removeChild(t.projectItem[0]);this.isShowDescProject&&t.descrProject.parentNode.removeChild(t.descrProject);this._showTreePanel&&t.projectNameItem.parentNode.removeChild(t.projectNameItem);this._oDataHeight-=11+this.heightTaskItem;if(this.Project.length==0&&this.isShowNewProject){var s=new Date(this.startDate),o=new Date(s.setDate(s.getDate()+1)),u=new GanttProjectInfo(1,"New project",o);this.Project.push(u);var t=new GanttProject(this,u);t.create();this.arrProjects.push(t);this._oDataHeight+=11+this.heightTaskItem}}else this.Error.throwError("DATA_INSERT_ERROR",31,[e])};GanttProject.prototype.setName=function(e){if(e!=""&&e!=null){this.Project.Name=e;if(this.Chart._showTreePanel){this.projectNameItem.innerHTML=e;this.projectNameItem.title=e;this.checkWidthProjectNameItem()}this.Chart.isShowDescProject&&(this.descrProject.innerHTML=this.getDescStr());this.addDayInPanelTime()}};GanttProject.prototype.setPercentCompleted=function(e){e=parseInt(e);if(isNaN(e)){this.Chart.Error.throwError("DATA_INSERT_ERROR",6,null);return!1}if(e>100){this.Chart.Error.throwError("DATA_INSERT_ERROR",7,null);return!1}if(e<0){this.Chart.Error.throwError("DATA_INSERT_ERROR",8,null);return!1}if(e>0&&e<100&&this.percentCompleted>0&&this.percentCompleted<100){this.projectItem[0].firstChild.rows[0].cells[0].width=parseInt(e)+"%";this.projectItem[0].firstChild.rows[0].cells[0].firstChild.style.width=e*this.Duration*this.Chart.hourInPixelsWork/100+"px";this.projectItem[0].firstChild.rows[0].cells[1].width=100-parseInt(e)+"%";this.projectItem[0].firstChild.rows[0].cells[1].firstChild.style.width=(100-e)*this.Duration*this.Chart.hourInPixelsWork/100+"px"}else if((e==0||e==100)&&this.percentCompleted>0&&this.percentCompleted<100){if(e==0){this.projectItem[0].firstChild.rows[0].cells[0].parentNode.removeChild(this.projectItem[0].firstChild.rows[0].cells[0]);this.projectItem[0].firstChild.rows[0].cells[0].width="100%";this.projectItem[0].firstChild.rows[0].cells[0].firstChild.style.width=this.Duration*this.Chart.hourInPixelsWork+"px"}else if(e==100){this.projectItem[0].firstChild.rows[0].cells[1].parentNode.removeChild(this.projectItem[0].firstChild.rows[0].cells[1]);this.projectItem[0].firstChild.rows[0].cells[0].width="100%";this.projectItem[0].firstChild.rows[0].cells[0].firstChild.style.width=this.Duration*this.Chart.hourInPixelsWork+"px"}}else if(e!=0&&e!=100||this.percentCompleted!=0&&this.percentCompleted!=100)if(!(e>0||e<100)||this.percentCompleted!=0&&this.percentCompleted!=100){if(this.percentCompleted==-1)if(e==100)this.projectItem[0].firstChild.rows[0].cells[0].firstChild.src=this.Chart.imgs+"parentnode_filled.png";else if(e<100&&e>0){this.projectItem[0].firstChild.rows[0].cells[0].parentNode.removeChild(this.projectItem[0].firstChild.rows[0].cells[0]);var t=document.createElement("TD");this.projectItem[0].firstChild.rows[0].appendChild(t);t.width=e+"%";var n=document.createElement("img");n.style.width=e*this.Duration*this.Chart.hourInPixelsWork/100+"px";n.style.height=this.Chart.heightTaskItem+"px";t.appendChild(n);n.src=this.Chart.imgs+"parentnode_filled.png";t=document.createElement("TD");this.projectItem[0].firstChild.rows[0].appendChild(t);t.width=100-e+"%";n=document.createElement("img");n.style.width=(100-e)*this.Duration*this.Chart.hourInPixelsWork/100+"px";n.style.height=this.Chart.heightTaskItem+"px";t.appendChild(n);n.src=this.Chart.imgs+"progress_bg.png"}}else{this.projectItem[0].firstChild.rows[0].cells[0].parentNode.removeChild(this.projectItem[0].firstChild.rows[0].cells[0]);var t=document.createElement("TD");this.projectItem[0].firstChild.rows[0].appendChild(t);t.width=e+"%";var n=document.createElement("img");n.style.width=e*this.Duration*this.Chart.hourInPixelsWork/100+"px";n.style.height=this.Chart.heightTaskItem+"px";t.appendChild(n);n.src=this.Chart.imgs+"parentnode_filled.png";t=document.createElement("TD");this.projectItem[0].firstChild.rows[0].appendChild(t);t.width=100-e+"%";n=document.createElement("img");n.style.width=(100-e)*this.Duration*this.Chart.hourInPixelsWork/100+"px";n.style.height=this.Chart.heightTaskItem+"px";t.appendChild(n);n.src=this.Chart.imgs+"progress_bg.png"}else e==0&&this.percentCompleted==100?this.projectItem[0].firstChild.rows[0].cells[0].firstChild.src=this.Chart.imgs+"progress_bg.png":e==100&&this.percentCompleted==0&&(this.projectItem[0].firstChild.rows[0].cells[0].firstChild.src=this.Chart.imgs+"parentnode_filled.png");this.percentCompleted=e;this.Chart.isShowDescProject&&(this.descrProject.innerHTML=this.getDescStr());return!0};GanttProject.prototype.deleteChildTask=function(e){if(e){e.cTaskItem[0].style.display=="none"&&this.Chart.openTree(e.parentTask);if(e.childPredTask.length>0)for(var t=0;t<e.childPredTask.length;t++){for(var n=0;n<e.childPredTask[t].cTaskItem[1].length;n++)e.childPredTask[t].cTaskItem[1][n].parentNode.removeChild(e.childPredTask[t].cTaskItem[1][n]);e.childPredTask[t].cTaskItem[1]=[];e.childPredTask[t].predTask=null}if(e.childTask.length>0)while(e.childTask.length>0)this.deleteChildTask(e.childTask[0]);e.cTaskItem[0].style.display!="none"&&e.shiftCurrentTasks(e,-23);this.Project.deleteTask(e.TaskInfo.Id);e.cTaskItem[0]&&e.cTaskItem[0].parentNode.removeChild(e.cTaskItem[0]);this.Chart.isShowDescTask&&e.descrTask.parentNode.removeChild(e.descrTask);if(e.cTaskItem[1].length>0)for(var r=0;r<e.cTaskItem[1].length;r++)e.cTaskItem[1][r].parentNode.removeChild(e.cTaskItem[1][r]);e.cTaskNameItem[0]&&e.cTaskNameItem[0].parentNode.removeChild(e.cTaskNameItem[0]);if(e.cTaskNameItem[1])for(var r=0;r<e.cTaskNameItem[1].length;r++)e.cTaskNameItem[1][r].parentNode.removeChild(e.cTaskNameItem[1][r]);e.cTaskNameItem[2]&&e.cTaskNameItem[2].parentNode.removeChild(e.cTaskNameItem[2]);if(e.parentTask){e.previousChildTask&&(e.nextChildTask?e.previousChildTask.nextChildTask=e.nextChildTask:e.previousChildTask.nextChildTask=null);var i=e.parentTask;for(var t=0;t<i.childTask.length;t++)if(i.childTask[t].TaskInfo.Id==e.TaskInfo.Id){i.childTask[t]=null;i.childTask.splice(t,1);break}if(i.childTask.length==0&&i.cTaskNameItem[2]){i.cTaskNameItem[2].parentNode.removeChild(i.cTaskNameItem[2]);i.cTaskNameItem[2]=null}}else{e.previousParentTask&&(e.nextParentTask?e.previousParentTask.nextParentTask=e.nextParentTask:e.previousParentTask.nextParentTask=null);var s=e.Project;for(var t=0;t<s.arrTasks.length;t++)s.arrTasks[t].TaskInfo.Id==e.TaskInfo.Id&&s.arrTasks.splice(t,1)}if(e.predTask){var o=e.predTask;for(var t=0;t<o.childPredTask.length;t++)if(o.childPredTask[t].TaskInfo.Id==e.TaskInfo.Id){o.childPredTask[t]=null;o.childPredTask.splice(t,1)}}if(e.Project.arrTasks.length!=0)e.Project.shiftProjectItem();else{e.Project.projectItem[0].style.display="none";this.Chart.isShowDescProject&&this.hideDescrProject()}this.Chart._oDataHeight-=11+this.Chart.heightTaskItem}};GanttProject.prototype.insertTask=function(e,t,n,r,i,s,o){var u=null,a=null;if(this.Project.getTaskById(e)){this.Chart.Error.throwError("DATA_INSERT_ERROR",22,[e]);return!1}if(!r||r<this.Chart.minWorkLength)r=this.Chart.minWorkLength;if(!t||t=="")t=e;if(!i||i=="")i=0;else{i=parseInt(i);if(i<0||i>100){this.Chart.Error.throwError("DATA_INSERT_ERROR",35,null);return!1}}var f=!1;if(o&&o!=""){var l=this.Project.getTaskById(o);if(!l){this.Chart.Error.throwError("DATA_INSERT_ERROR",21,[o]);return!1}n=n||l.EST;if(n<l.EST){this.Chart.Error.throwError("DATA_INSERT_ERROR",20,[e,o]);return!1}u=new GanttTaskInfo(e,t,n,r,i,s);if(!this.Chart.checkPosParentTask(l,u)){this.Chart.Error.throwError("DATA_INSERT_ERROR",19,[o,e]);return!1}u.ParentTask=l;var c=this.getTaskById(l.Id),h=!1;c.cTaskItem[0].style.display=="none"?h=!0:c.cTaskNameItem[2]&&(c._isOpen||(h=!0));h&&(c.childTask.length==0?this.Chart.openTree(c.parentTask):this.Chart.openTree(c));if(s!=""){var p=this.Project.getTaskById(s);if(!p){this.Chart.Error.throwError("DATA_INSERT_ERROR",27,[s]);return!1}if(!p.ParentTask){this.Chart.Error.throwError("DATA_INSERT_ERROR",32,[p.Id,u.Id]);return!1}if(p.ParentTask.Id!=u.ParentTask.Id){this.Chart.Error.throwError("DATA_INSERT_ERROR",32,[p.Id,u.Id]);return!1}this.Chart.checkPosPredecessorTask(p,u)||this.Chart.correctPosPredecessorTask(p,u);u.PredecessorTask=p}var d=!1;if(f)for(var v=0;v<l.ChildTasks.length;v++)if(u.EST<l.ChildTasks[v].EST){l.ChildTasks.splice(v,0,u);if(v>0){l.ChildTasks[v-1].nextChildTask=l.ChildTasks[v];l.ChildTasks[v].previousChildTask=l.ChildTasks[v-1]}if(l.ChildTasks[v+1]){l.ChildTasks[v+1].previousChildTask=l.ChildTasks[v];l.ChildTasks[v].nextChildTask=l.ChildTasks[v+1]}d=!0;break}if(!d){if(l.ChildTasks.length>0){l.ChildTasks[l.ChildTasks.length-1].nextChildTask=u;u.previousChildTask=l.ChildTasks[l.ChildTasks.length-1]}l.ChildTasks.push(u)}l.ChildTasks.length==1&&(c.cTaskNameItem[2]=c.createTreeImg());a=new GanttTask(u,this,this.Chart);a.create();u.nextChildTask&&(a.nextChildTask=a.Project.getTaskById(u.nextChildTask.Id));a.addDayInPanelTime();a.shiftCurrentTasks(a,23)}else{n=n||this.Project.StartDate;u=new GanttTaskInfo(e,t,n,r,i,s);if(u.EST<=this.Chart.startDate){this.Chart.Error.throwError("DATA_INSERT_ERROR",18,[u.Id]);return!1}if(s!=""){var p=this.Project.getTaskById(s);if(!p){this.Chart.Error.throwError("DATA_INSERT_ERROR",27,[s]);return!1}this.Chart.checkPosPredecessorTask(p,u)||this.Chart.correctPosPredecessorTask(p,u);if(p.ParentTask){this.Chart.Error.throwError("DATA_INSERT_ERROR",15,[u.Id,p.Id]);return!1}u.PredecessorTask=p}var d=!1;if(f)for(var v=0;v<this.Project.ParentTasks.length;v++)if(n<this.Project.ParentTasks[v].EST){this.Project.ParentTasks.splice(v,0,u);if(v>0){this.Project.ParentTasks[v-1].nextParentTask=u;u.previousParentTask=this.Project.ParentTasks[v-1]}if(this.Project.ParentTasks[v+1]){this.Project.ParentTasks[v+1].previousParentTask=u;u.nextParentTask=this.Project.ParentTasks[v+1]}d=!0;break}if(!d){if(this.Project.ParentTasks.length>0){this.Project.ParentTasks[this.Project.ParentTasks.length-1].nextParentTask=u;u.previousParentTask=this.Project.ParentTasks[this.Project.ParentTasks.length-1]}this.Project.ParentTasks.push(u)}a=new GanttTask(u,this,this.Chart);a.create();u.nextParentTask&&(a.nextParentTask=a.Project.getTaskById(u.nextParentTask.Id));a.addDayInPanelTime();this.arrTasks.push(a);a.shiftCurrentTasks(a,23);this.projectItem[0].style.display="inline";this.setPercentCompleted(this.getPercentCompleted());this.shiftProjectItem();this.Chart.isShowDescProject&&this.showDescrProject()}this.Chart.checkHeighPanelTasks();return a};GanttChart.prototype.checkPosPredecessorTask=function(e,t){var n=this.getWidthOnDuration(e.Duration),r=this.getPosOnDate(e.EST),i=this.getPosOnDate(t.EST);return n+r<=i};GanttChart.prototype.correctPosPredecessorTask=function(e,t,n){var r=new Date(e.EST);r.setHours(r.getHours()+e.Duration/this.hoursInDay*24);if(r.getHours()>0){r.setHours(0);r.setDate(r.getDate()+1)}n?n.setEST(r,!0):t.EST=r;if(t.ParentTask&&!this.checkPosParentTask(t.ParentTask,t)){var i=new Date(t.ParentTask.EST);i.setHours(i.getHours()+t.ParentTask.Duration/this.hoursInDay*24);t.Duration=parseInt(parseInt((i-t.EST)/36e5)*this.hoursInDay/24)}};GanttChart.prototype.correctPosParentTask=function(e,t){if(!t.PredecessorTask){e.EST>t.EST&&(t.EST=new Date(e.EST));this.checkPosParentTask(e,t)||(t.Duration=e.Duration)}else this.correctPosPredecessorTask(t.PredecessorTask,t)};GanttChart.prototype.checkPosParentTaskInTree=function(e){var t=!1;for(var n=0;n<e.ChildTasks.length;n++){if(!this.checkPosParentTask(e,e.ChildTasks[n])){if(!this.correctError){this.Error.throwError("DATA_ERROR",28,[e.Id,e.ChildTasks[n].Id]);return!0}this.correctPosParentTask(e,e.ChildTasks[n])}if(e.EST>e.ChildTasks[n].EST){if(!this.correctError){this.Error.throwError("DATA_ERROR",33,[e.Id,e.ChildTasks[n].Id]);return!0}this.correctPosParentTask(e,e.ChildTasks[n])}e.ChildTasks[n].ChildTasks.length>0&&(t=this.checkPosParentTaskInTree(e.ChildTasks[n]))}return t};GanttChart.prototype.setPredTask=function(e){var t=!1;for(var n=0;n<e.ParentTasks.length;n++){if(!this.isEmpty(e.ParentTasks[n].PredecessorTaskId)){e.ParentTasks[n].PredecessorTask=e.getTaskById(e.ParentTasks[n].PredecessorTaskId);if(!e.ParentTasks[n].PredecessorTask&&!this.correctError){this.Error.throwError("DATA_ERROR",27,[e.ParentTasks[n].PredecessorTaskId]);return!0}e.ParentTasks[n].PredecessorTask.ChildPredTasks.push(e.ParentTasks[n])}if(e.ParentTasks[n].PredecessorTask&&!this.checkPosPredecessorTask(e.ParentTasks[n].PredecessorTask,e.ParentTasks[n])){if(!this.correctError){this.Error.throwError("DATA_ERROR",26,[e.ParentTasks[n].PredecessorTask.Id,e.ParentTasks[n].Id]);return!0}this.correctPosPredecessorTask(e.ParentTasks[n].PredecessorTask,e.ParentTasks[n])}t=this.setPredTaskInTree(e.ParentTasks[n]);if(t)return t}return t};GanttChart.prototype.setPredTaskInTree=function(e){var t=!1;for(var n=0;n<e.ChildTasks.length;n++){if(!this.isEmpty(e.ChildTasks[n].PredecessorTaskId)){e.ChildTasks[n].PredecessorTask=e.Project.getTaskById(e.ChildTasks[n].PredecessorTaskId);if(!e.ChildTasks[n].PredecessorTask&&!this.correctError){this.Error.throwError("DATA_ERROR",27,[e.ChildTasks[n].PredecessorTaskId]);return!0}if(!this.checkPosPredecessorTask(e.ChildTasks[n].PredecessorTask,e.ChildTasks[n])){if(!this.correctError){this.Error.throwError("DATA_ERROR",26,[e.ChildTasks[n].PredecessorTask.Id,e.ChildTasks[n].Id]);return!0}this.correctPosPredecessorTask(e.ChildTasks[n].PredecessorTask,e.ChildTasks[n])}e.ChildTasks[n].PredecessorTask.ChildPredTasks.push(e.ChildTasks[n])}e.ChildTasks[n].ChildTasks.length>0&&(t=this.setPredTaskInTree(e.ChildTasks[n]))}return t};GanttChart.prototype.checkPosParentTask=function(e,t){var n=this.getWidthOnDuration(e.Duration),r=this.getPosOnDate(e.EST),i=this.getPosOnDate(t.EST),s=this.getWidthOnDuration(t.Duration);return n+r>=i+s};GanttChart.prototype.insertProject=function(e,t,n){if(this._isError){this.clearData();this.clearItems();this.hidePanelErrors();this._isError=!1}if(this.startDate>=n){this.Error.throwError("DATA_INSERT_ERROR",14,null);return!1}if(this.getProjectById(e)){this.Error.throwError("DATA_INSERT_ERROR",23,[e]);return!1}this.checkHeighPanelTasks();var r=new GanttProjectInfo(e,t,n);this.Project.push(r);var i=new GanttProject(this,r);for(var s=0;s<this.arrProjects.length;s++)if(n<this.arrProjects[s].Project.StartDate){this.arrProjects.splice(s,0,i);if(s>0){i.previousProject=this.arrProjects[s-1];this.arrProjects[s-1].nextProject=i}if(s+1<=this.arrProjects.length){i.nextProject=this.arrProjects[s+1];this.arrProjects[s+1].previousProject=i;i.shiftNextProject(i,23)}i.create();this.isShowDescProject&&i.hideDescrProject();return i}if(this.arrProjects.length>0){this.arrProjects[this.arrProjects.length-1].nextProject=i;i.previousProject=this.arrProjects[this.arrProjects.length-1]}this.arrProjects.push(i);i.create();this.isShowDescProject&&i.hideDescrProject();return i};GanttChart.prototype._showContextMenu=function(e,t){if(this.contextMenu.isDhtmlxMenuObject){var n=this.callEvent("onBeforeContextMenu",[this.contextMenu,t]);if(n===!1)return;var r,i;if(_isIE){var s=window.document.documentElement,o=window.document.body,u=new Array(s.scrollLeft||o.scrollLeft,s.scrollTop||o.scrollTop);r=e.clientX+u[0];i=e.clientY+u[1]}else{r=e.pageX;i=e.pageY}this.contextMenu.showContextMenu(r-1,i-1)}else{var a=e.srcElement||e.target;this.contextMenu.showContextMenu(a.style.left,a.style.top,t)}};GanttChart.prototype.openTree=function(e){var t=this.getLastCloseParent(e);if(e.TaskInfo.Id!=t.TaskInfo.Id){this.openNode(t);this.openTree(e)}else this.openNode(t)};GanttChart.prototype.openNode=function(e){if(!e._isOpen){e.cTaskNameItem[2].src=this.imgs+"minus.gif";e._isOpen=!0;e.shiftCurrentTasks(e,e._heightHideTasks);e.showChildTasks(e,e._isOpen);e._heightHideTasks=0}};GanttChart.prototype.getLastCloseParent=function(e){return e.parentTask?!e.parentTask._isOpen||e.parentTask.cTaskNameItem[2].style.display=="none"?this.getLastCloseParent(e.parentTask):e:e};GanttTask.prototype.setPredecessor=function(e){if(e=="")this.clearPredTask();else{var t=this.TaskInfo;if(t.Id==e){this.Chart.Error.throwError("DATA_INSERT_ERROR",36);return!1}var n=this.Project.getTaskById(e);if(!n){this.Chart.Error.throwError("DATA_INSERT_ERROR",27,[e]);return!1}var r=n.TaskInfo,i=r.ParentTask==null,s=t.ParentTask==null;if(i&&!s||!i&&s||!i&&!s&&r.ParentTask.Id!=t.ParentTask.Id){this.Chart.Error.throwError("DATA_INSERT_ERROR",32,[r.Id,t.Id]);return!1}this.clearPredTask();this.Chart.checkPosPredecessorTask(r,t)||this.Chart.correctPosPredecessorTask(r,t,this);t.PredecessorTaskId=e;t.PredecessorTask=r;this.predTask=n;n.childPredTask.push(this);this.cTaskItem[1]=this.createConnectingLinesDS()}return!0};GanttTask.prototype.clearPredTask=function(){if(this.predTask){var e=this.predTask.childPredTask;for(var t=0;t<e.length;t++)if(e[t]==this){e.splice(t,1);break}for(var t=0;t<this.cTaskItem[1].length;t++)this.cTaskItem[1][t].parentNode.removeChild(this.cTaskItem[1][t]);this.cTaskItem[1]=[];this.TaskInfo.PredecessorTaskId=null;this.TaskInfo.PredecessorTask=null;this.predTask=null}};GanttTask.prototype.setEST=function(e,t){this.moveChild=t;this.getMoveInfo();var n=this.Chart.getPosOnDate(e);if(parseInt(this.cTaskItem[0].firstChild.firstChild.width)+n>this.maxPosXMove&&this.maxPosXMove!=-1){this.Chart.Error.throwError("DATA_INSERT_ERROR",12,[this.TaskInfo.Id]);this.maxPosXMove=-1;this.minPosXMove=-1;return!1}if(n<this.minPosXMove){this.Chart.Error.throwError("DATA_INSERT_ERROR",11,[this.TaskInfo.Id]);this.maxPosXMove=-1;this.minPosXMove=-1;return!1}this.cTaskItem[0].style.left=n;var r=n-this.posX;this.moveCurrentTaskItem(r,t);this.Project.shiftProjectItem();this.Chart.isShowDescTask&&(this.descrTask.innerHTML=this.getDescStr());this.addDayInPanelTime();this.posX=0;this.maxPosXMove=-1;this.minPosXMove=-1;return!0};GanttTask.prototype.setDuration=function(e){this.getResizeInfo();var t=this.Chart.getWidthOnDuration(e);if(t>this.maxWidthResize&&this.maxWidthResize!=-1){this.Chart.Error.throwError("DATA_INSERT_ERROR",10,[this.TaskInfo.Id]);return!1}if(t<this.minWidthResize){this.Chart.Error.throwError("DATA_INSERT_ERROR",9,[this.TaskInfo.Id]);return!1}this.taskItemWidth=parseInt(this.cTaskItem[0].firstChild.firstChild.width);this.resizeTaskItem(t);this.endResizeItem();this.Chart.isShowDescTask&&(this.descrTask.innerHTML=this.getDescStr());return!0};GanttTask.prototype.setPercentCompleted=function(e){e=parseInt(e);if(isNaN(e)){this.Chart.Error.throwError("DATA_INSERT_ERROR",6,null);return!1}if(e>100){this.Chart.Error.throwError("DATA_INSERT_ERROR",7,null);return!1}if(e<0){this.Chart.Error.throwError("DATA_INSERT_ERROR",8,null);return!1}if(e!=0&&e!=100){if(this.TaskInfo.PercentCompleted!=0&&this.TaskInfo.PercentCompleted!=100){this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0].width=e+"%";this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[1].width=100-e+"%"}else if(this.TaskInfo.PercentCompleted==0||this.TaskInfo.PercentCompleted==100){this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0].parentNode.removeChild(this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0]);var t=document.createElement("td");this.cTaskItem[0].childNodes[0].firstChild.rows[0].appendChild(t);t.height=this.Chart.heightTaskItem+"px";t.width=e+"%";var n=document.createElement("img");n.style.width=e*this.TaskInfo.Duration*this.Chart.hourInPixelsWork/100+"px";n.style.height=this.Chart.heightTaskItem+"px";t.appendChild(n);n.src=this.Chart.imgs+"progress_filled.png";t=document.createElement("td");this.cTaskItem[0].childNodes[0].firstChild.rows[0].appendChild(t);t.height=this.Chart.heightTaskItem+"px";t.width=100-e+"%";n=document.createElement("img");n.style.width=(100-e)*this.TaskInfo.Duration*this.Chart.hourInPixelsWork/100+"px";n.style.height=this.Chart.heightTaskItem+"px";t.appendChild(n);n.src=this.Chart.imgs+"progress_bg.png"}}else if(e==0)if(this.TaskInfo.PercentCompleted!=0&&this.TaskInfo.PercentCompleted!=100){this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0].parentNode.removeChild(this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0]);this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0].width="100%"}else this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0].firstChild.src=this.Chart.imgs+"progress_bg.png";else if(e==100)if(this.TaskInfo.PercentCompleted!=0&&this.TaskInfo.PercentCompleted!=100){this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[1].parentNode.removeChild(this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[1]);this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0].width="100%"}else this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0].firstChild.src=this.Chart.imgs+"progress_filled.png";this.TaskInfo.PercentCompleted=e;this.taskItemWidth=parseInt(this.cTaskItem[0].firstChild.firstChild.width);this.resizeTaskItem(this.taskItemWidth);this.endResizeItem();this.Chart.isShowDescTask&&(this.descrTask.innerHTML=this.getDescStr());return!0};GanttTask.prototype.setName=function(e){if(e!=""&&e!=null){this.TaskInfo.Name=e;if(this.Chart._showTreePanel){this.cTaskNameItem[0].innerHTML=e;this.cTaskNameItem[0].title=e;this.checkWidthTaskNameItem()}this.Chart.isShowDescTask&&(this.descrTask.innerHTML=this.getDescStr());this.addDayInPanelTime()}};GanttChart.prototype.getProjectInfoById=function(e){for(var t=0;t<this.Project.length;t++)if(this.Project[t].Id==e)return this.Project[t];return null};GanttChart.prototype.loadData=function(e,t,n){this.clearData();if(t==null||t=="undefined")t=!1;if(n==null||n=="undefined")n=!1;this.loadXML(e,t,n);this.Project.sort(this.sort_byStartDate);this.startDate=this.getStartDate();this.clearItems();for(var r=0;r<this.Project.length;r++){for(var i=0;i<this.Project[r].ParentTasks.length;i++){if(this.Project[r].ParentTasks[i].EST==null||this.Project[r].ParentTasks[i].EST==""){this.Error.throwError("DATA_ERROR",25,[this.Project[r].ParentTasks[i].Id]);return}this.setESTChild(this.Project[r].ParentTasks[i]);if(this.setPredTask(this.Project[r]))return}for(var i=0;i<this.Project[r].ParentTasks.length;i++){if(this.Project[r].ParentTasks[i].EST<this.Project[r].StartDate){this.Error.throwError("DATA_ERROR",24,[this.Project[r].ParentTasks[i].Id,this.Project[r].Id]);return}if(this.checkPosParentTaskInTree(this.Project[r].ParentTasks[i]))return}this.sortTasksByEST(this.Project[r])
}for(var r=0;r<this.Project.length;r++){var s=new GanttProject(this,this.Project[r]);if(this.arrProjects.length>0){var o=this.arrProjects[this.arrProjects.length-1];s.previousProject=o;o.nextProject=s}s.create();this.checkHeighPanelTasks();this.arrProjects.push(s);this.createTasks(s)}};GanttChart.prototype.clearAll=function(){this._oDataHeight=0;this.startDate=null;this._isError=!1;this.hidePanelErrors();this.clearData();this.clearItems()};GanttChart.prototype.clearData=function(){this._oDataHeight=0;this.startDate=null;this._isError=!1;this.hidePanelErrors();this.Project=[];this.arrProjects=[]};GanttChart.prototype.clearItems=function(){this.oData.removeChild(this.oData.firstChild);this.oData.appendChild(this.createPanelTasks());this.oData.firstChild.appendChild(this.divInfo);this.oData.firstChild.appendChild(this.panelErrors);if(this._showTreePanel){this.panelNames.removeChild(this.panelNames.firstChild);this.panelNames.appendChild(this.createPanelNamesTasks())}this.panelTime.removeChild(this.panelTime.firstChild);this.panelTime.appendChild(this.createPanelTime())};GanttChart.prototype.loadXML=function(e,t,n){if(!(!t||e!=null&&e!="")){this.Error.throwError("DATA_SEND_ERROR",4,null);return}this.xmlLoader=new dtmlXMLLoaderObject(function(){},this,!1);try{if(!t)try{this.xmlLoader.loadXMLString(e)}catch(r){this.Error.throwError("DATA_LOAD_ERROR",37,[e])}else n?this.xmlLoader.loadXML(e+"?rnd="+(new Date-0),!1):this.xmlLoader.loadXML(this.loadPath+"?path="+e+"&rnd="+(new Date-0),!1);this.doLoadDetails(n)}catch(r){this.Error.throwError("DATA_LOAD_ERROR",5,[e])}};GanttChart.prototype.doLoadDetails=function(e){switch(this.xmlLoader.xmlDoc.status){case 0:if(!e){this.Error.throwError("DATA_LOAD_ERROR",1,null);return}break;case 404:e?this.Error.throwError("DATA_LOAD_ERROR",5,[this.xmlLoader.filePath]):this.Error.throwError("DATA_LOAD_ERROR",5,[this.loadPath]);return;case 500:this.Error.throwError("DATA_LOAD_ERROR",2,null);return;default:}var t=null,n=null,r=null,i=null,s=null,o=null,u=this.xmlLoader.doXPath("//project");for(var a=0;a<u.length;a++){var f=u[a].getAttribute("startdate"),l=f.split(","),c=new GanttProjectInfo(u[a].getAttribute("id"),u[a].getAttribute("name"),new Date(l[0],parseInt(l[1])-1,l[2])),h=this.xmlLoader.doXPath("./task",u[a]);for(var p=0;p<h.length;p++){n=h[p].getAttribute("id");t=this.xmlLoader.doXPath("./name",h[p])[0].firstChild==null?"":this.xmlLoader.doXPath("./name",h[p])[0].firstChild.nodeValue;var d=this.xmlLoader.doXPath("./est",h[p])[0].firstChild==null?"":this.xmlLoader.doXPath("./est",h[p])[0].firstChild.nodeValue;r=d.split(",");i=this.xmlLoader.doXPath("./duration",h[p])[0].firstChild==null?"":this.xmlLoader.doXPath("./duration",h[p])[0].firstChild.nodeValue;s=this.xmlLoader.doXPath("./percentcompleted",h[p])[0].firstChild==null?"":this.xmlLoader.doXPath("./percentcompleted",h[p])[0].firstChild.nodeValue;o=this.xmlLoader.doXPath("./predecessortasks",h[p])[0].firstChild==null?"":this.xmlLoader.doXPath("./predecessortasks",h[p])[0].firstChild.nodeValue;var v=new GanttTaskInfo(n,t,new Date(r[0],parseInt(r[1])-1,r[2]),i,s,o),m=this.xmlLoader.doXPath("./childtasks",h[p]),g=this.xmlLoader.doXPath("./task",m[0]);g.length!=0&&this.readChildTasksXML(v,g);c.addTask(v)}this.addProject(c)}};GanttChart.prototype.readChildTasksXML=function(e,t){var n=null,r=null,i=null,s=null,o=null,u=null;for(var a=0;a<t.length;a++){r=t[a].getAttribute("id");n=this.xmlLoader.doXPath("./name",t[a])[0].firstChild==null?"":this.xmlLoader.doXPath("./name",t[a])[0].firstChild.nodeValue;var f=this.xmlLoader.doXPath("./est",t[a])[0].firstChild==null?"":this.xmlLoader.doXPath("./est",t[a])[0].firstChild.nodeValue;i=f.split(",");s=this.xmlLoader.doXPath("./duration",t[a])[0].firstChild==null?"":this.xmlLoader.doXPath("./duration",t[a])[0].firstChild.nodeValue;o=this.xmlLoader.doXPath("./percentcompleted",t[a])[0].firstChild==null?"":this.xmlLoader.doXPath("./percentcompleted",t[a])[0].firstChild.nodeValue;u=this.xmlLoader.doXPath("./predecessortasks",t[a])[0].firstChild==null?"":this.xmlLoader.doXPath("./predecessortasks",t[a])[0].firstChild.nodeValue;var l=new GanttTaskInfo(r,n,new Date(i[0],parseInt(i[1])-1,i[2]),s,o,u);l.ParentTask=e;e.addChildTask(l);var c=this.xmlLoader.doXPath("./childtasks",t[a]),h=this.xmlLoader.doXPath("./task",c[0]);h.length!=0&&this.readChildTasksXML(l,h)}};GanttChart.prototype.getXML=function(){var e="<projects>";for(var t=0;t<this.Project.length;t++){e+="<project id ='"+this.Project[t].Id+"' name= '"+this.Project[t].Name+"' startdate = '"+this.Project[t].StartDate.getFullYear()+","+(this.Project[t].StartDate.getMonth()+1)+","+this.Project[t].StartDate.getDate()+"'>";for(var n=0;n<this.Project[t].ParentTasks.length;n++){e+="<task id ='"+this.Project[t].ParentTasks[n].Id+"'>";e+="<name>"+this.Project[t].ParentTasks[n].Name+"</name>";e+="<est>"+this.Project[t].ParentTasks[n].EST.getFullYear()+","+(this.Project[t].ParentTasks[n].EST.getMonth()+1)+","+this.Project[t].ParentTasks[n].EST.getDate()+"</est>";e+="<duration>"+this.Project[t].ParentTasks[n].Duration+"</duration>";e+="<percentcompleted>"+this.Project[t].ParentTasks[n].PercentCompleted+"</percentcompleted>";e+="<predecessortasks>"+this.Project[t].ParentTasks[n].PredecessorTaskId+"</predecessortasks>";e+="<childtasks>";e+=this.createChildTasksXML(this.Project[t].ParentTasks[n].ChildTasks);e+="</childtasks>";e+="</task>"}e+="</project>"}e+="</projects>";return e};GanttChart.prototype.createChildTasksXML=function(e){var t="";for(var n=0;n<e.length;n++){t+="<task id='"+e[n].Id+"'>";t+="<name>"+e[n].Name+"</name>";t+="<est>"+e[n].EST.getFullYear()+","+(e[n].EST.getMonth()+1)+","+e[n].EST.getDate()+"</est>";t+="<duration>"+e[n].Duration+"</duration>";t+="<percentcompleted>"+e[n].PercentCompleted+"</percentcompleted>";t+="<predecessortasks>"+e[n].PredecessorTaskId+"</predecessortasks>";if(e[n].ChildTasks){t+="<childtasks>";t+=this.createChildTasksXML(e[n].ChildTasks);t+="</childtasks>"}t+="</task>"}return t};GanttChart.prototype.sort_byEST=function(e,t){return e.EST<t.EST?-1:e.EST>t.EST?1:0};GanttChart.prototype.sort_byStartDate=function(e,t){return e.StartDate<t.StartDate?-1:e.StartDate>t.StartDate?1:0};GanttChart.prototype.setESTChild=function(e){for(var t=0;t<e.ChildTasks.length;t++){if(e.ChildTasks[t].EST==null||e.ChildTasks[t].EST=="")e.ChildTasks[t].EST=e.EST;e.ChildTasks[t].ChildTasks.length!=0&&this.setESTChild(e.ChildTasks[t])}};GanttChart.prototype.createPanelTasks=function(){var e=document.createElement("div");e.className="taskPanel";e.style.cssText="position:relative;";e.style.height=this.contentHeight-63+"px";var t=this.startDate?this.startDate.getDay()-1:(new Date(0)).getDay()-1;t==-1&&(t=6);e.style.background="url("+this.imgs+"bg_week.png) -"+t*24+"px 0px";this.panelTasks=e;return e};GanttChart.prototype.createPanelNamesTasks=function(){var e=document.createElement("div");e.innerHTML="&nbsp;";e.style.cssText="position:relative;background:url("+this.imgs+"bg.png)";e.style.height=this.contentHeight-63+"px";e.style.width=this.maxWidthPanelNames+"px";return e};GanttChart.prototype.createPopUpInfo=function(){var e=document.createElement("div");e.style.cssText="display: none;";var t=document.createElement("table");t.style.cssText="position:absolute;top:0px;left:0px";t.className="poPupInfo";e.appendChild(t);var n=t.insertRow(t.rows.length),r=document.createElement("td");n.appendChild(r);this.divInfo=e;return e};GanttChart.prototype.createPopUpTimeInfo=function(){var e=document.createElement("div");e.style.display="none";var t=document.createElement("table");t.className="poPupTime";e.appendChild(t);var n=t.insertRow(t.rows.length),r=document.createElement("td");r.align="center";n.appendChild(r);return e};GanttChart.prototype.createPanelTime=function(){var e=document.createElement("div");e.style.position="relative";var t=document.createElement("table");e.appendChild(t);t.cellPadding="0px";t.border="0px";t.cellSpacing="0px";t.bgColor="#FFFFFF";t.style.marginTop="0px";var n=t.insertRow(t.rows.length),r=t.insertRow(t.rows.length);for(var i=0;i<this.countDays;i++){this.addPointInTimePanel(r,e);this.addDayInPanelTime(r)}return e};GanttChart.prototype.addPointInTimePanel=function(e,t){var n=document.createElement("div");n.style.cssText="position:absolute;left:"+e.cells.length*this.dayInPixels+"px;top:20px;height:20px;width:1px;font-size:1px;margin-left:0px;margin-right:0px;margin-top:0px;margin-bottom:0px;background:#f1f3f1;";t.appendChild(n)};GanttChart.prototype._calculateMonthColSpan=function(e,t){var n=e.getMonth();for(var r=1;r<=t;r++){e.setDate(e.getDate()+1);var i=e.getMonth();if(i!=n)return r}return t};GanttChart.prototype.getMonthScaleLabel=function(e){return(this._useShortMonthNames?this.shortMonthNames:this.monthNames)[e.getMonth()]+" '"+(""+e.getFullYear()).substring(2)};GanttChart.prototype.useShortMonthNames=function(e){this._useShortMonthNames=e};GanttChart.prototype.setShortMonthNames=function(e){this.shortMonthNames=e};GanttChart.prototype.setMonthNames=function(e){this.monthNames=e};GanttChart.prototype.addDayInPanelTime=function(e){var t=this,n=e.cells.length,r=new Date(this.startDate),i=e.insertCell(n);i.style.height="20px";i.style.width=this.dayInPixels+"px";i.className="dayNumber";r.setDate(r.getDate()+parseInt(n));var s=r.getDate();i.innerHTML=s;i.setAttribute("idx",n);var o=e.parentNode.parentNode.rows[0];if(n==0||s==1){var u=o.insertCell(o.cells.length);u.className="monthName";u.style.height="20px";o.cells.length%2==0&&(u.style.backgroundColor="#f7f8f7");u.colSpan=this._calculateMonthColSpan(new Date(r),Math.max(1,this.countDays-n));u.innerHTML=this.getMonthScaleLabel(r)}else{var a=o.cells.length,f=0;for(var l=0;l<a;l++)f+=o.cells[l].colSpan;n>=f&&(o.cells[a-1].colSpan+=1)}var c=r.getDay();if(c==0||c==6)i.style.backgroundColor="#f7f8f7"};GanttChart.prototype.incHeightPanelTasks=function(e){var t=this.oData.firstChild;t.style.height=parseInt(t.style.height)+e+"px"};GanttChart.prototype.incHeightPanelNames=function(e){var t=this.panelNames.firstChild;t.style.height=parseInt(t.style.height)+e+"px"};GanttChart.prototype.checkHeighPanelTasks=function(){this._oDataHeight+=11+this.heightTaskItem;if(parseInt(this.oData.firstChild.style.height)<=this._oDataHeight){this.incHeightPanelTasks(this.heightTaskItem+11);this._showTreePanel&&this.incHeightPanelNames(this.heightTaskItem+11)}};GanttChart.prototype.sortTasksByEST=function(e){e.ParentTasks.sort(this.sort_byEST);for(var t=0;t<e.ParentTasks.length;t++)e.ParentTasks[t]=this.sortChildTasks(e.ParentTasks[t])};GanttChart.prototype.sortChildTasks=function(e){e.ChildTasks.sort(this.sort_byEST);for(var t=0;t<e.ChildTasks.length;t++)e.ChildTasks[t].ChildTasks.length>0&&this.sortChildTasks(e.ChildTasks[t]);return e};GanttChart.prototype.errorDataHandler=function(e,t,n){if(!this._isError){this.clearData();this.showPanelErrors();this._isError=!0}this.addErrorInPanelErrors(e,t)};GanttChart.prototype.createPanelErrors=function(){var e=document.createElement("table");e.width="100%";e.style.display="none";e.className="panelErrors";this.panelErrors=e;return e};GanttChart.prototype.showPanelErrors=function(){this.panelErrors.style.display="inline"};GanttChart.prototype.hidePanelErrors=function(){for(var e=0;e<this.panelErrors.rows.length;e++)this.panelErrors.rows[e].parentNode.removeChild(this.panelErrors.rows[e]);this.panelErrors.style.display="none"};GanttChart.prototype.addErrorInPanelErrors=function(e,t){var n=this.panelErrors.insertRow(this.panelErrors.rows.length),r=document.createElement("td");r.style.height="20px";r.style.width="100px";r.innerHTML=e;n.appendChild(r);r=document.createElement("td");n.appendChild(r);r.innerHTML=t};GanttChart.prototype.errorSendDataHandler=function(e,t,n){alert(t)};GanttChart.prototype.errorLoadDataHandler=function(e,t,n){alert(t)};GanttChart.prototype.errorAPIHandler=function(e,t,n){alert(t)};GanttChart.prototype.saveData=function(e){try{this.dhtmlXMLSenderObject.isProcessed||this.dhtmlXMLSenderObject.sendData(e,this.savePath,this.getXML())}catch(t){this.Error.throwError("DATA_SEND_ERROR",t,null)}};GanttChart.prototype.create=function(e){var t=this,n=document.getElementById(e);this.content=n;this.getBrowserType();if(this._isIE){document.body.attachEvent("onselectstart",function(){window.event.returnValue=!1});document.body.attachEvent("onkeydown",function(){event.keyCode==65&&event.ctrlKey&&(window.event.returnValue=!1)})}else{n.addEventListener("mousedown",function(e){e.preventDefault()},!0);document.addEventListener("keydown",function(e){e.keyCode==65&&e.ctrlKey&&e.preventDefault()},!0)}this.Error.catchError("DATA_ERROR",function(e,n,r){t.errorDataHandler(e,n,r)});this.Error.catchError("DATA_SEND_ERROR",function(e,n,r){t.errorSendDataHandler(e,n,r)});this.Error.catchError("DATA_INSERT_ERROR",function(e,n,r){t.errorAPIHandler(e,n,r)});this.Error.catchError("DATA_LOAD_ERROR",function(e,n,r){t.errorLoadDataHandler(e,n,r)});var r=document.createElement("table");r.cellPadding="0";r.cellSpacing="0";r.style.cssText="width: 100%; position: relative;";var i=r.insertRow(r.rows.length),s;this.contentHeight=n.offsetHeight;this.contentWidth=n.offsetWidth;n.appendChild(r);this.countDays=this.getCountDays();this.Project.sort(this.sort_byStartDate);this.startDate=this.getStartDate();this.panelTime=document.createElement("div");this.panelTime.appendChild(this.createPanelTime());this.panelTime.style.cssText="position:relative;overflow:hidden;height:40px;top:0px;left:1px";this.oData=document.createElement("div");this.oData.appendChild(this.createPanelTasks());this.oData.style.cssText="position:relative;overflow:scroll;height:"+(this.contentHeight-40)+"px;border-left:#f1f3f1 1px solid";this.oData.firstChild.appendChild(this.createPanelErrors());if(this._showTreePanel){this.panelNames=document.createElement("div");s=document.createElement("td");s.vAlign="top";this.panelNames.appendChild(this.createPanelNamesTasks());this.panelNames.style.cssText="position:relative;top:40px;overflow:hidden;border-left:#f1f3f1 1px solid;border-bottom:#f1f3f1 1px solid";s.appendChild(this.panelNames);i.appendChild(s)}s=document.createElement("td");var o=document.createElement("div");o.style.cssText="position: relative;";o.appendChild(this.panelTime);o.appendChild(this.oData);s.appendChild(o);i.appendChild(s);if(this._showTreePanel){this.panelNames.style.height=this.contentHeight-56+"px";this.panelNames.style.width=this.maxWidthPanelNames+"px";this.oData.style.width=this.contentWidth-this.maxWidthPanelNames+"px";this.panelTasks.style.width=this.dayInPixels*this.countDays+"px";this.panelTime.style.width=this.contentWidth-this.maxWidthPanelNames-0+"px";this.panelTime.firstChild.style.width=this.dayInPixels*this.countDays+"px";this.isShowConMenu&&this.contextMenu==null&&(this.contextMenu=new contextMenu(this))}else{this.oData.style.width=this.contentWidth+"px";this.panelTime.style.width=this.contentWidth-16+"px"}this._isOpera&&(this.oData.onmousewheel=function(){return!1});this.oData.onscroll=function(){t.panelTime.scrollLeft=this.scrollLeft;if(t.panelNames){t.panelNames.scrollTop=this.scrollTop;t.isShowConMenu&&t.contextMenu.hideContextMenu()}};this.divTimeInfo=this.createPopUpTimeInfo();o.appendChild(this.divTimeInfo);this.oData.firstChild.appendChild(this.createPopUpInfo());for(var u=0;u<this.Project.length;u++){for(var a=0;a<this.Project[u].ParentTasks.length;a++){this.isEmpty(this.Project[u].ParentTasks[a].EST)&&(this.Project[u].ParentTasks[a].EST=this.Project[u].StartDate);this.setESTChild(this.Project[u].ParentTasks[a]);if(this.setPredTask(this.Project[u]))return}for(var a=0;a<this.Project[u].ParentTasks.length;a++){if(this.Project[u].ParentTasks[a].EST<this.Project[u].StartDate){if(!this.correctError){this.Error.throwError("DATA_ERROR",24,[this.Project[u].ParentTasks[a].Id,this.Project[u].Id]);return}this.Project[u].ParentTasks[a].EST=this.Project[u].StartDate}if(this.checkPosParentTaskInTree(this.Project[u].ParentTasks[a]))return}this.sortTasksByEST(this.Project[u])}for(var u=0;u<this.Project.length;u++){var f=new GanttProject(this,this.Project[u]);if(this.arrProjects.length>0){var l=this.arrProjects[this.arrProjects.length-1];f.previousProject=l;l.nextProject=f}f.create();this.checkHeighPanelTasks();this.arrProjects.push(f);this.createTasks(f)}return this};GanttChart.prototype.isEmpty=function(e){return e==null||e==""};GanttChart.prototype.getPrintableHTML=function(){var e=parseInt(this.oData.firstChild.style.width)-parseInt(this.oData.style.width),t=parseInt(this.panelTasks.style.height)-parseInt(this.panelTasks.parentNode.style.height);this.oData.setAttribute("id","ganttPrint02");this.panelNames.setAttribute("id","ganttPrint03");var n='<html><head><link type="text/css" rel="stylesheet" href="'+this.stylePath+'"><scr'+"ipt>onload=function(){var w="+e+",h="+t+',c1=document.getElementById("ganttPrint01"),c2=document.getElementById("ganttPrint02"),c3=document.getElementById("ganttPrint03");'+'c2.style.width=parseInt(c2.style.width)+w+"px";c2.previousSibling.style.width=c2.style.width;c1.style.width=parseInt(c1.style.width)+w+"px";c2.style.height=parseInt(c2.style.height)+h+"px";'+'c2.style.overflow="hidden";c3.style.height=c3.firstChild.style.height;c1.style.height=parseInt(c1.style.height)+h+"px";}</scr'+"ipt></head>"+'<body><div id="ganttPrint01" style="'+this.content.style.cssText+'">'+this.content.innerHTML+"</div></body></html>";this.oData.setAttribute("id",null);this.panelNames.setAttribute("id",null);return n};GanttChart.prototype.printToWindow=function(e){var t=window.open();t.document.write(this.getPrintableHTML());t.document.close();e!==null&&t.alert(e?e:'Use browser\'s menu "File->Print preview" to setup page layout.')};GanttChart.prototype.getStartDate=function(){for(var e=0;e<this.Project.length;e++)this.startDate?this.Project[e].StartDate<this.startDate&&(this.startDate=new Date(this.Project[e].StartDate)):this.startDate=new Date(this.Project[e].StartDate);this.initialPos=24*this.hourInPixels;return this.startDate?new Date(this.startDate.setHours(this.startDate.getHours()-24)):new Date};GanttChart.prototype.getCountDays=function(){return this._showTreePanel?parseInt((this.contentWidth-this.maxWidthPanelNames)/(this.hourInPixels*24)):parseInt(this.contentWidth/(this.hourInPixels*24))};GanttChart.prototype.createTasks=function(e){for(var t=0;t<e.Project.ParentTasks.length;t++){if(t>0){e.Project.ParentTasks[t-1].nextParentTask=e.Project.ParentTasks[t];e.Project.ParentTasks[t].previousParentTask=e.Project.ParentTasks[t-1]}var n=new GanttTask(e.Project.ParentTasks[t],e,this);e.arrTasks.push(n);n.create();this.checkHeighPanelTasks();e.Project.ParentTasks[t].ChildTasks.length>0&&this.createChildItemControls(e.Project.ParentTasks[t].ChildTasks,e)}};GanttChart.prototype.createChildItemControls=function(e,t){for(var n=0;n<e.length;n++){if(n>0){e[n].previousChildTask=e[n-1];e[n-1].nextChildTask=e[n]}var r=new GanttTask(e[n],t,this);r.create();this.checkHeighPanelTasks();e[n].ChildTasks.length>0&&this.createChildItemControls(e[n].ChildTasks,t)}};GanttTask.prototype.getPopUpInfo=function(e,t){var n=e.offsetTop+this.Chart.heightTaskItem+6,r=e.offsetLeft+(t.layerX==null?t.offsetX:t.layerX),i=this.Chart.divInfo.lastChild;i.rows[0].cells[0].innerHTML="<div style='font-family: Arial, Helvetica, Sans-serif; font-size: 12px; font-weight: bold; color: #688060; margin: 0 0 4px 0;'>"+this.TaskInfo.Name+"</div>";i.rows[0].cells[0].innerHTML+="<span class='st'>EST:&nbsp;</span><span class='ut'>"+this.TaskInfo.EST.getDate()+"."+(this.TaskInfo.EST.getMonth()+1)+"."+this.TaskInfo.EST.getFullYear()+"</span><br/>";i.rows[0].cells[0].innerHTML+="<span class='st'>Duration:&nbsp;</span><span class='ut'>"+this.TaskInfo.Duration+" hours </span><br/>";i.rows[0].cells[0].innerHTML+="<span class='st'>Percent Complete:&nbsp;</span><span class='ut'>"+this.TaskInfo.PercentCompleted+"% </span><br/>";if(this.predTask){i.rows[0].cells[0].innerHTML+="<span class='st'>Predecessor Task:&nbsp;</span>";i.rows[0].cells[0].innerHTML+="<span class='lt'>*"+this.TaskInfo.PredecessorTask.Name+"</span>"}if(this.TaskInfo.ChildTasks.length!=0){i.rows[0].cells[0].innerHTML+="<span class='st'>Child Tasks:&nbsp;</span>";for(var s=0;s<this.TaskInfo.ChildTasks.length;s++)i.rows[0].cells[0].innerHTML+=s==this.TaskInfo.ChildTasks.length-1?"<span class='lt'>*"+this.TaskInfo.ChildTasks[s].Name+"</span>":"<span class='lt'>*"+this.TaskInfo.ChildTasks[s].Name+"</span>"}if(this.TaskInfo.ParentTask){i.rows[0].cells[0].innerHTML+="<span class='st'>Parent Task:&nbsp;</span>";i.rows[0].cells[0].innerHTML+="<span class='lt'>*"+this.TaskInfo.ParentTask.Name+"</span>"}this.Chart.divInfo.style.cssText="z-index:2;position: absolute;display: inline;";n+this.Chart.divInfo.lastChild.offsetHeight+10>this.Chart.oData.offsetHeight+this.Chart.oData.scrollTop?this.Chart.divInfo.style.top=n-this.Chart.divInfo.lastChild.offsetHeight-10-this.Chart.heightTaskItem+"px":this.Chart.divInfo.style.top=n+"px";this.Chart.divInfo.lastChild.offsetWidth+r+10>this.Chart.oData.offsetWidth+this.Chart.oData.scrollLeft?this.Chart.divInfo.style.left=r-(this.Chart.divInfo.lastChild.offsetWidth+r+20-(this.Chart.oData.offsetWidth+this.Chart.oData.scrollLeft))+"px":this.Chart.divInfo.style.left=r+"px"};GanttTask.prototype.closePopUpInfo=function(){this.Chart.divInfo.style.display="none"};GanttTask.prototype.createConnectingLinesPN=function(){var e=[];return e};GanttTask.prototype.createConnectingLinesDS=function(){var e=this.Chart.oData.firstChild,t=[],n=new Image;n.src=this.Chart.imgs+"arr.gif";var r=document.createElement("div"),i=document.createElement("div"),s=parseInt(this.predTask.cTaskItem[0].style.left),o=parseInt(this.predTask.cTaskItem[0].style.top),u=parseInt(this.cTaskItem[0].style.left),a=this.posY+2,f=parseInt(this.predTask.cTaskItem[0].firstChild.firstChild.width),l=parseInt(this.predTask.cTaskItem[0].firstChild.firstChild.width);if(o<a){r.style.cssText="border-width: 0px 0px 0px 1px; border-style: solid; border-color: #4A8F43;margin: 0px; padding: 0px;z-index:0;font-size: 1px;position: absolute;height:"+(a-this.Chart.heightTaskItem/2-o-3)+"px;width:"+1+"px;left:"+(s+l-20)+"px;top:"+(o+this.Chart.heightTaskItem)+"px;";i.style.cssText="height:1px;border-color: #4A8F43;border-style: solid;border-width: 1px 0px 0px 0px;margin: 0px; padding: 0px;z-index:0;position: absolute;width:"+(15+(u-(l+s)))+"px;left:"+(s+l-20)+"px;top:"+(a+2)+"px;";n.style.cssText="margin: 0px; padding: 0px;width:7px;height:14px;position: absolute;left:"+(u-7)+"px;top:"+(a-1)+"px;"}else{r.style.cssText="border-width: 0px 0px 0px 1px; border-style: solid; border-color: #4A8F43;margin: 0px; padding: 0px;z-index:0;font-size: 1px;position: absolute;height:"+(o+2-a)+"px;width:"+1+"px;left:"+(s+l-20)+"px;top:"+(a+2)+"px;";i.style.cssText="height:1px;border-color: #4A8F43;border-style: solid;border-width: 1px 0px 0px 0px;margin: 0px; padding: 0px;z-index:0;position: absolute;width:"+(15+(u-(l+s)))+"px;left:"+(s+l-20)+"px;top:"+(a+2)+"px;";n.style.cssText="margin: 0px; padding: 0px;width:7px;height:14px;position: absolute;left:"+(u-7)+"px;top:"+(a-1)+"px;"}e.appendChild(r);e.appendChild(i);e.appendChild(n);t.push(r);t.push(n);t.push(i);return t};GanttTask.prototype.showChildTasks=function(e,t){if(t)for(var n=0;n<e.childTask.length;n++)if(e.childTask[n].cTaskItem[0].style.display=="none"){e.childTask[n].cTaskItem[0].style.display="inline";e.childTask[n].cTaskNameItem[0].style.display="inline";this.Chart.isShowDescTask&&e.childTask[n].showDescTask();e.isHide=!1;if(e.childTask[n].cTaskNameItem[2]){e.childTask[n].cTaskNameItem[2].style.display="inline";t=e.childTask[n]._isOpen}for(var r=0;r<e.childTask[n].cTaskItem[1].length;r++)e.childTask[n].cTaskItem[1][r].style.display="inline";for(var r=0;r<e.childTask[n].cTaskNameItem[1].length;r++)e.childTask[n].cTaskNameItem[1][r].style.display="inline";this._heightHideTasks+=this.Chart.heightTaskItem+11;e.childTask[n].childTask.length>0&&this.showChildTasks(e.childTask[n],t)}};GanttTask.prototype.hideChildTasks=function(e){for(var t=0;t<e.childTask.length;t++)if(e.childTask[t].cTaskItem[0].style.display!="none"){e.childTask[t].cTaskItem[0].style.display="none";e.childTask[t].cTaskNameItem[0].style.display="none";this.Chart.isShowDescTask&&e.childTask[t].hideDescTask();e.isHide=!0;e.childTask[t].cTaskNameItem[2]&&(e.childTask[t].cTaskNameItem[2].style.display="none");for(var n=0;n<e.childTask[t].cTaskItem[1].length;n++)e.childTask[t].cTaskItem[1][n].style.display="none";for(var n=0;n<e.childTask[t].cTaskNameItem[1].length;n++)e.childTask[t].cTaskNameItem[1][n].style.display="none";this._heightHideTasks+=this.Chart.heightTaskItem+11;e.childTask[t].childTask.length>0&&this.hideChildTasks(e.childTask[t])}};GanttTask.prototype.shiftCurrentTasks=function(e,t){this.shiftNextTask(this,t);e.Project.shiftNextProject(e.Project,t)};GanttProject.prototype.shiftNextProject=function(e,t){if(e.nextProject){e.nextProject.shiftProject(t);this.shiftNextProject(e.nextProject,t)}};GanttProject.prototype.shiftProject=function(e){this.projectItem[0].style.top=parseInt(this.projectItem[0].style.top)+e+"px";this.Chart.isShowDescProject&&(this.descrProject.style.top=parseInt(this.descrProject.style.top)+e+"px");this.Chart._showTreePanel&&(this.projectNameItem.style.top=parseInt(this.projectNameItem.style.top)+e+"px");this.arrTasks.length>0&&this.shiftNextParentTask(this.arrTasks[0],e)};GanttProject.prototype.shiftTask=function(e,t){if(this.Chart._showTreePanel){e.cTaskNameItem[0].style.top=parseInt(e.cTaskNameItem[0].style.top)+t+"px";e.cTaskNameItem[2]&&(e.cTaskNameItem[2].style.top=parseInt(e.cTaskNameItem[2].style.top)+t+"px");if(e.parentTask&&e.cTaskNameItem[1][0]){e.cTaskNameItem[1][0].style.top=parseInt(e.cTaskNameItem[1][0].style.top)+t+"px";e.cTaskNameItem[1][1].style.top=parseInt(e.cTaskNameItem[1][1].style.top)+t+"px"}}e.cTaskItem[0].style.top=parseInt(e.cTaskItem[0].style.top)+t+"px";this.Chart.isShowDescTask&&(e.descrTask.style.top=parseInt(e.descrTask.style.top)+t+"px");if(e.cTaskItem[1][0]){e.cTaskItem[1][0].style.top=parseInt(e.cTaskItem[1][0].style.top)+t+"px";e.cTaskItem[1][1].style.top=parseInt(e.cTaskItem[1][1].style.top)+t+"px";e.cTaskItem[1][2].style.top=parseInt(e.cTaskItem[1][2].style.top)+t+"px"}};GanttProject.prototype.shiftNextParentTask=function(e,t){this.shiftTask(e,t);this.shiftChildTasks(e,t);e.nextParentTask&&this.shiftNextParentTask(e.nextParentTask,t)};GanttProject.prototype.shiftChildTasks=function(e,t){for(var n=0;n<e.childTask.length;n++){this.shiftTask(e.childTask[n],t);e.childTask[n].childTask.length>0&&this.shiftChildTasks(e.childTask[n],t)}};GanttTask.prototype.shiftTask=function(e,t){if(this.Chart._showTreePanel){e.cTaskNameItem[0].style.top=parseInt(e.cTaskNameItem[0].style.top)+t+"px";e.cTaskNameItem[2]&&(e.cTaskNameItem[2].style.top=parseInt(e.cTaskNameItem[2].style.top)+t+"px");if(e.parentTask){e.cTaskNameItem[1].length>0&&(parseInt(this.cTaskNameItem[0].style.top)>parseInt(e.parentTask.cTaskNameItem[0].style.top)&&e.cTaskNameItem[1][0].style.display!="none"?e.cTaskNameItem[1][0].style.height=parseInt(e.cTaskNameItem[1][0].style.height)+t+"px":e.cTaskNameItem[1][0].style.top=parseInt(e.cTaskNameItem[1][0].style.top)+t+"px");e.cTaskNameItem[1].length>1&&(e.cTaskNameItem[1][1].style.top=parseInt(e.cTaskNameItem[1][1].style.top)+t+"px")}}e.cTaskItem[0].style.top=parseInt(e.cTaskItem[0].style.top)+t+"px";this.Chart.isShowDescTask&&(e.descrTask.style.top=parseInt(e.descrTask.style.top)+t+"px");if(e.predTask){e.cTaskItem[1].length>0&&((parseInt(this.cTaskItem[0].style.top)>parseInt(e.predTask.cTaskItem[0].style.top)||this.cTaskItem[0].id==e.predTask.TaskInfo.Id)&&e.cTaskItem[1][0].style.display!="none"?e.cTaskItem[1][0].style.height=parseInt(e.cTaskItem[1][0].style.height)+t+"px":e.cTaskItem[1][0].style.top=parseInt(e.cTaskItem[1][0].style.top)+t+"px");if(e.cTaskItem[1].length>2){e.cTaskItem[1][1].style.top=parseInt(e.cTaskItem[1][1].style.top)+t+"px";e.cTaskItem[1][2].style.top=parseInt(e.cTaskItem[1][2].style.top)+t+"px"}}};GanttTask.prototype.shiftNextTask=function(e,t){if(e.nextChildTask){this.shiftTask(e.nextChildTask,t);this.shiftChildTask(e.nextChildTask,t);this.shiftNextTask(e.nextChildTask,t)}else if(e.parentTask)this.shiftNextTask(e.parentTask,t);else if(e.nextParentTask){this.shiftTask(e.nextParentTask,t);this.shiftChildTask(e.nextParentTask,t);this.shiftNextTask(e.nextParentTask,t)}};GanttTask.prototype.shiftChildTask=function(e,t){for(var n=0;n<e.childTask.length;n++){this.shiftTask(e.childTask[n],t);e.childTask[n].childTask.length>0&&this.shiftChildTask(e.childTask[n],t)}};GanttChart.prototype.getPosOnDate=function(e){return(e-this.startDate)/36e5*this.hourInPixels};GanttChart.prototype.getWidthOnDuration=function(e){return Math.round(this.hourInPixelsWork*e)};GanttTask.prototype.endMove=function(){var e=parseInt(this.cTaskItem[0].style.left)-this.posX,t=this.getDateOnPosition(parseInt(this.cTaskItem[0].style.left));t=this.checkPos(t);this.wasMoved=this.TaskInfo.EST.valueOf()!=t.valueOf();if(this.checkMove){e=this.Chart.getPosOnDate(t)-this.posX;this.moveCurrentTaskItem(e,this.moveChild);this.Project.shiftProjectItem()}this.checkMove=!1;this.posX=0;this.maxPosXMove=-1;this.minPosXMove=-1;this.cTaskItem[0].childNodes[1].firstChild.rows[0].cells[0].innerHTML="";this.Chart._isFF&&(document.body.style.cursor="");this.Chart._isIE&&(this.cTaskItem[0].childNodes[2].childNodes[0].style.cursor="")};GanttTask.prototype.checkPos=function(e){var t=e.getHours();if(t>=12){e.setDate(e.getDate()+1);e.setHours(0);if(parseInt(this.cTaskItem[0].firstChild.firstChild.width)+this.Chart.getPosOnDate(e)>this.maxPosXMove&&this.maxPosXMove!=-1){e.setDate(e.getDate()-1);e.setHours(0)}}else if(t<12&&t!=0){e.setHours(0);this.Chart.getPosOnDate(e)<this.minPosXMove&&e.setDate(e.getDate()+1)}this.cTaskItem[0].style.left=this.Chart.getPosOnDate(e)+"px";return e};GanttTask.prototype.getMaxPosPredChildTaskItem=function(){var e=0,t=0;for(var n=0;n<this.childPredTask.length;n++){t=this.getMaxPosPredChildTaskItemInTree(this.childPredTask[n]);t>e&&(e=t)}return e};GanttTask.prototype.getMaxPosPredChildTaskItemInTree=function(e){var t=parseInt(e.cTaskItem[0].firstChild.firstChild.width)+parseInt(e.cTaskItem[0].style.left),n=0,r=0;for(var i=0;i<e.childPredTask.length;i++){r=this.getMaxPosPredChildTaskItemInTree(e.childPredTask[i]);r>n&&(n=r)}return n>t?n:t};GanttProject.prototype.getTaskById=function(e){for(var t=0;t<this.arrTasks.length;t++){var n=this.searchTaskInTree(this.arrTasks[t],e);if(n)return n}return null};GanttProject.prototype.searchTaskInTree=function(e,t){if(e.TaskInfo.Id==t)return e;for(var n=0;n<e.childTask.length;n++){if(e.childTask[n].TaskInfo.Id==t)return e.childTask[n];if(e.childTask[n].childTask.length>0){var r=this.searchTaskInTree(e.childTask[n],t);if(r)return r}}return null};GanttProject.prototype.shiftProjectItem=function(){var e=null,t=null,n=parseInt(this.projectItem[0].style.left),r=parseInt(this.projectItem[0].firstChild.style.width)+parseInt(this.projectItem[0].style.left),i=parseInt(this.projectItem[0].firstChild.style.width);for(var s=0;s<this.arrTasks.length;s++){var o=parseInt(this.arrTasks[s].cTaskItem[0].style.left),u=parseInt(this.arrTasks[s].cTaskItem[0].style.left)+parseInt(this.arrTasks[s].cTaskItem[0].firstChild.firstChild.width);e||(e=o);t||(t=u);e>o&&(e=o);t<u&&(t=u)}if(e!=n){this.Project.StartDate=new Date(this.Chart.startDate);this.Project.StartDate.setHours(this.Project.StartDate.getHours()+e/this.Chart.hourInPixels)}this.projectItem[0].style.left=e+"px";this.resizeProjectItem(t-e);this.Duration=Math.round(parseInt(this.projectItem[0].firstChild.width)/this.Chart.hourInPixelsWork);this.Chart.isShowDescProject&&this.moveDescrProject();this.addDayInPanelTime()};GanttProject.prototype.addDayInPanelTime=function(){var e=parseInt(this.projectItem[0].style.left)+parseInt(this.projectItem[0].firstChild.style.width)+20;this.Chart.isShowDescProject&&(e+=this.descrProject.offsetWidth);var t=this.Chart.panelTime.firstChild,n=t.firstChild;if(parseInt(n.offsetWidth)<e){var r=Math.round((e-parseInt(n.offsetWidth))/this.Chart.dayInPixels),i=n.rows[1];for(var s=0;s<r;s++){this.Chart.addPointInTimePanel(i,t);this.Chart.addDayInPanelTime(i)}var o=this.Chart.dayInPixels*i.cells.length;n.style.width=o+"px";this.Chart.panelTasks.style.width=o-18+"px"}};GanttProject.prototype.addEvent=function(e,t,n,r){if(e.addEventListener){e.addEventListener(t,n,r);return!0}if(e.attachEvent)return e.attachEvent("on"+t,n);e["on"+t]=n};GanttProject.prototype.getPopUpInfo=function(e,t){var n=e.offsetLeft+(t.layerX==null?t.offsetX:t.layerX),r=e.offsetTop+this.Chart.heightTaskItem+6,i=this.Chart.divInfo.lastChild;i.rows[0].cells[0].innerHTML="<div style='font-family: Arial, Helvetica, Sans-serif; font-size: 12px; font-weight: bold; color: #688060; margin:0 0 4px 0;'>"+
this.Project.Name+"</div>";i.rows[0].cells[0].innerHTML+="<span class='st'>Start Date:&nbsp;</span><span class='ut'>"+this.Project.StartDate.getDate()+"."+(this.Project.StartDate.getMonth()+1)+"."+this.Project.StartDate.getFullYear()+"</span><br/>";i.rows[0].cells[0].innerHTML+="<span class='st'>Duration:&nbsp;</span><span class='ut'>"+this.Duration+" hours</span><br/>";i.rows[0].cells[0].innerHTML+="<span class='st'>Percent Complete:&nbsp;</span><span class='ut'>"+this.percentCompleted+"%</span><br/>";this.Chart.divInfo.style.cssText="z-index:2;position: absolute;display: inline;";r+this.Chart.divInfo.lastChild.offsetHeight+6>this.Chart.oData.offsetHeight+this.Chart.oData.scrollTop?this.Chart.divInfo.style.top=r-this.Chart.divInfo.lastChild.offsetHeight-10-this.Chart.heightTaskItem+"px":this.Chart.divInfo.style.top=r+"px";this.Chart.divInfo.lastChild.offsetWidth+n+10>this.Chart.oData.offsetWidth+this.Chart.oData.scrollLeft?this.Chart.divInfo.style.left=n-(this.Chart.divInfo.lastChild.offsetWidth+n+20-(this.Chart.oData.offsetWidth+this.Chart.oData.scrollLeft))+"px":this.Chart.divInfo.style.left=n+"px"};GanttProject.prototype.closePopUpInfo=function(){this.Chart.divInfo.style.display="none"};GanttProject.prototype.resizeProjectItem=function(e){var t=this.percentCompleted;if(t>0&&t<100){this.projectItem[0].firstChild.style.width=e+"px";this.projectItem[0].firstChild.width=e+"px";this.projectItem[0].style.width=e+"px";this.projectItem[0].firstChild.rows[0].cells[0].firstChild.style.width=Math.round(e*t/100)+"px";this.projectItem[0].firstChild.rows[0].cells[1].firstChild.style.width=Math.round(e*(100-t)/100)+"px";this.projectItem[0].lastChild.firstChild.width=e+"px"}else if(t==0||t==100){this.projectItem[0].firstChild.style.width=e+"px";this.projectItem[0].firstChild.width=e+"px";this.projectItem[0].style.width=e+"px";this.projectItem[0].firstChild.rows[0].cells[0].firstChild.style.width=e+"px";this.projectItem[0].lastChild.firstChild.width=e+"px"}};GanttTask.prototype.moveCurrentTaskItem=function(e,t){var n=this.cTaskItem[0];this.TaskInfo.EST=new Date(this.Chart.startDate);this.TaskInfo.EST.setHours(this.TaskInfo.EST.getHours()+parseInt(n.style.left)/this.Chart.hourInPixels);this.Chart.isShowDescTask&&this.showDescTask();if(this.cTaskItem[1].length>0){this.cTaskItem[1][2].style.width=parseInt(this.cTaskItem[1][2].style.width)+e+"px";this.cTaskItem[1][1].style.left=parseInt(this.cTaskItem[1][1].style.left)+e+"px"}for(var r=0;r<this.childTask.length;r++)this.childTask[r].predTask||this.moveChildTaskItems(this.childTask[r],e,t);for(var r=0;r<this.childPredTask.length;r++)this.moveChildTaskItems(this.childPredTask[r],e,t)};GanttTask.prototype.moveChildTaskItems=function(e,t,n){var r=e.cTaskItem[0];if(n){r.style.left=parseInt(r.style.left)+t+"px";e.addDayInPanelTime();e.TaskInfo.EST=new Date(this.Chart.startDate);e.TaskInfo.EST.setHours(e.TaskInfo.EST.getHours()+parseInt(r.style.left)/this.Chart.hourInPixels);for(var i=0;i<e.cTaskItem[1].length;i++)e.cTaskItem[1][i].style.left=parseInt(e.cTaskItem[1][i].style.left)+t+"px";for(var s=0;s<e.childTask.length;s++)e.childTask[s].predTask||this.moveChildTaskItems(e.childTask[s],t,n);for(var s=0;s<e.childPredTask.length;s++)this.moveChildTaskItems(e.childPredTask[s],t,n)}else if(e.cTaskItem[1].length>0){e.cTaskItem[1][2].style.left=parseInt(e.cTaskItem[1][2].style.left)+t+"px";e.cTaskItem[1][2].style.width=parseInt(e.cTaskItem[1][2].style.width)-t+"px";e.cTaskItem[1][0].style.left=parseInt(e.cTaskItem[1][0].style.left)+t+"px"}this.Chart.isShowDescTask&&e.moveDescTask()};GanttTask.prototype.addDayInPanelTime=function(){var e=this.cTaskItem[0],t=parseInt(e.style.left)+parseInt(e.firstChild.firstChild.width)+20;this.Chart.isShowDescTask&&(t+=this.descrTask.offsetWidth);var n=this.Chart.panelTime.firstChild,r=n.firstChild;if(parseInt(r.offsetWidth)<t){var i=r.rows[1],s=Math.round((t+20-parseInt(r.offsetWidth))/this.Chart.dayInPixels);for(var o=0;o<s;o++){this.Chart.addPointInTimePanel(i,n);this.Chart.addDayInPanelTime(i)}var u=this.Chart.dayInPixels*i.cells.length;r.style.width=u+"px";this.Chart.panelTasks.style.width=u-18+"px"}};GanttTask.prototype.getDateOnPosition=function(e){var t=new Date(this.Chart.startDate);t.setHours(t.getHours()+e/this.Chart.hourInPixels);return t};GanttTask.prototype.moveItem=function(e){var t=e.screenX,n=this.posX+(t-this.MouseX),r=parseInt(this.cTaskItem[0].childNodes[0].firstChild.width),i=n+r;if(this.checkMove){var s=this.getDateOnPosition(n),o=this.Chart.callEvent("onTaskDragging",[this,s])!==!1;o&&this.minPosXMove<=n&&(i<=this.maxPosXMove||this.maxPosXMove==-1)&&this.moveTaskItem(n)}};GanttTask.prototype.moveTaskItem=function(e){this.addDayInPanelTime();this.cTaskItem[0].style.left=e+"px";var t=this.getDateOnPosition(e);this.cTaskItem[0].childNodes[1].firstChild.rows[0].cells[0].innerHTML=t.getDate()+"."+(t.getMonth()+1)+"."+t.getUTCFullYear()};GanttTask.prototype.resizeItem=function(e){if(this.checkResize){var t=e.screenX,n=this.taskItemWidth+(t-this.MouseX),r=Math.round(n/this.Chart.hourInPixelsWork);if(this.Chart.callEvent("onTaskResizing",[this,r])===!1)return;if(n>=this.taskItemWidth)if(n<=this.maxWidthResize||this.maxWidthResize==-1){this.resizeTaskItem(n);this.addDayInPanelTime()}else this.maxWidthResize!=-1&&n>this.maxWidthResize&&this.resizeTaskItem(this.maxWidthResize);else n<=this.taskItemWidth&&(n>=this.minWidthResize?this.resizeTaskItem(n):n<this.minWidthResize&&this.resizeTaskItem(this.minWidthResize))}};GanttTask.prototype.resizeTaskItem=function(e){var t=this.cTaskItem[0],n=Math.round(e/this.Chart.hourInPixelsWork),r=t.childNodes[0].firstChild.rows[0].cells[0];r&&(r.firstChild.style.width=parseInt(r.width)*e/100+"px");r=t.childNodes[0].firstChild.rows[0].cells[1];r&&(r.firstChild.style.width=parseInt(r.width)*e/100+"px");t.childNodes[0].firstChild.width=e+"px";t.childNodes[1].firstChild.width=e+"px";this.cTaskItem[0].childNodes[1].firstChild.rows[0].cells[0].innerHTML=n;t.childNodes[2].childNodes[0].style.width=e+"px";t.childNodes[2].childNodes[1].style.left=e-10+"px"};GanttTask.prototype.endResizeItem=function(){var e=this.cTaskItem[0];this.wasResized=this.taskItemWidth!=parseInt(e.childNodes[0].firstChild.width);if(this.wasResized){var t=e.offsetLeft,n=e.offsetLeft+parseInt(e.childNodes[0].firstChild.width);this.TaskInfo.Duration=Math.round((n-t)/this.Chart.hourInPixelsWork);if(this.childPredTask.length>0)for(var r=0;r<this.childPredTask.length;r++){this.childPredTask[r].cTaskItem[1][2].style.width=parseInt(this.childPredTask[r].cTaskItem[1][2].style.width)-(parseInt(e.childNodes[0].firstChild.width)-this.taskItemWidth)+"px";this.childPredTask[r].cTaskItem[1][2].style.left=parseInt(this.childPredTask[r].cTaskItem[1][2].style.left)+(parseInt(e.childNodes[0].firstChild.width)-this.taskItemWidth)+"px";this.childPredTask[r].cTaskItem[1][0].style.left=parseInt(this.childPredTask[r].cTaskItem[1][0].style.left)+(parseInt(e.childNodes[0].firstChild.width)-this.taskItemWidth)+"px"}}this.cTaskItem[0].childNodes[1].firstChild.rows[0].cells[0].innerHTML="";this.checkResize=!1;this.taskItemWidth=0;this.MouseX=0;this.Chart.isShowDescTask&&this.showDescTask();this.Project.shiftProjectItem();this.Chart._isFF&&(document.body.style.cursor="")};GanttProject.prototype.moveDescrProject=function(){this.descrProject.style.left=parseInt(this.projectItem[0].style.left)+this.Duration*this.Chart.hourInPixelsWork+10;this.descrProject.innerHTML=this.getDescStr()};GanttProject.prototype.showDescrProject=function(){var e=parseInt(this.projectItem[0].style.left)+this.Duration*this.Chart.hourInPixelsWork+10;this.descrProject.style.left=e+"px";this.descrProject.style.visibility="visible";this.descrProject.innerHTML=this.getDescStr()};GanttProject.prototype.hideDescrProject=function(){this.descrProject.style.visibility="hidden"};GanttProject.prototype.getDescStr=function(){var e="",t=", ";for(var n=0;n<this.Chart.paramShowProject.length;n++)switch(this.Chart.paramShowProject[n]){case"Name":e!=""&&(e+=t);e+=this.Project[this.Chart.paramShowProject[n]];break;case"StartDate":e!=""&&(e+=t);var r=this.Project[this.Chart.paramShowProject[n]];e+=r.getDate()+"."+(r.getMonth()+1)+"."+r.getFullYear();break;case"Duration":e!=""&&(e+=t);e+=this[this.Chart.paramShowProject[n]]+"h";break;case"percentCompleted":e!=""&&(e+=t);e+=this[this.Chart.paramShowProject[n]]+"%";break;default:}return e};GanttProject.prototype.createDescrProject=function(){var e=this.posX+this.Duration*this.Chart.hourInPixelsWork+10,t=document.createElement("div");t.style.cssText+=";z-index:1;position:absolute;left:"+e+"px;top:"+this.posY+"px;";t.innerHTML=this.getDescStr();t.className="descProject";this.descrProject=t;this.Project.ParentTasks.length==0&&(this.descrProject.style.visibility="hidden");if(this.Chart._showTooltip){var n=this,r=function(e){!n.Chart._isMove&&!n.Chart._isResize&&n.getPopUpInfo(n.descrProject,e)},i=function(){n.closePopUpInfo()};this.addEvent(t,"mouseover",r,!1);this.addEvent(t,"mouseout",i,!1)}return t};GanttProject.prototype.createProjectItem=function(){var e=this;this.percentCompleted=this.getPercentCompleted();this.Duration=this.getDuration();var t=document.createElement("div");t.id=this.Project.Id;t.style.cssText=";z-index:1;position: absolute;left:"+this.posX+"px;top:"+this.posY+"px;";t.style.width=this.Duration*this.Chart.hourInPixelsWork+"px";var n=document.createElement("table");t.appendChild(n);n.cellPadding="0";n.cellSpacing="0";n.style.cssText="border: solid 1px #BC810D;";var r=this.Duration*this.Chart.hourInPixelsWork;n.width=(r==0?1:r)+"px";n.style.width=(r==0?1:r)+"px";var i=n.insertRow(n.rows.length);if(this.percentCompleted!=-1){if(this.percentCompleted!=0){var s=document.createElement("TD");i.appendChild(s);s.width=this.percentCompleted+"%";s.style.lineHeight="1px";var o=document.createElement("img");o.style.width=this.percentCompleted*this.Duration*this.Chart.hourInPixelsWork/100+"px";o.style.height=this.Chart.heightTaskItem+"px";s.appendChild(o);o.src=this.Chart.imgs+"parentnode_filled.png"}if(this.percentCompleted!=100){var s=document.createElement("TD");i.appendChild(s);s.width=100-this.percentCompleted+"%";s.style.lineHeight="1px";var o=document.createElement("img");o.style.width=(100-this.percentCompleted)*this.Duration*this.Chart.hourInPixelsWork/100+"px";o.style.height=this.Chart.heightTaskItem+"px";s.appendChild(o);o.src=this.Chart.imgs+"progress_bg.png"}}else{var s=document.createElement("TD");i.appendChild(s);s.width="1px";s.style.lineHeight="1px";var o=document.createElement("img");o.style.width="1px";o.style.height=this.Chart.heightTaskItem;s.appendChild(o);o.src=this.Chart.imgs+"progress_bg.png"}var u=document.createElement("div");u.style.cssText="text-align:center;z-index:2;position:absolute;left:0px;top:0px;";var a=document.createElement("table");u.appendChild(a);a.cellPadding="0";a.cellSpacing="0";a.height=this.Chart.heightTaskItem+"px";a.width=(this.Duration*this.Chart.hourInPixelsWork==0?1:this.Duration*this.Chart.hourInPixelsWork)+"px";var f=a.insertRow(0),l=document.createElement("td");l.align="center";l.vAlign="top";l.height=this.Chart.heightTaskItem+"px";l.className="moveInfo";l.style.cssText=";white-space:nowrap;";f.appendChild(l);t.appendChild(u);this.Project.ParentTasks.length==0&&(t.style.display="none");if(this.Chart._showTooltip){var c=function(t){!e.Chart._isMove&&!e.Chart._isResize&&e.getPopUpInfo(e.projectItem[0],t)},h=function(){e.closePopUpInfo()};this.addEvent(u,"mouseover",c,!1);this.addEvent(u,"mouseout",h,!1)}return t};GanttProject.prototype.createProjectNameItem=function(){var e=this,t=document.createElement("div");t.style.cssText="cursor:pointer;color:#003366;font-weight:bold;font-size:12px;font-family:Tahoma,Arial;white-space:nowrap;height:15px;z-index:1;position:absolute;left:5px;top:"+this.posY+"px;";t.innerHTML=this.Project.Name;t.title=this.Project.Name;if(this.Chart.isShowConMenu){var n=function(t){e.Chart.contextMenu.clear&&e.Chart.contextMenu.clear();var n=null;e.Chart._isIE?n=function(){e.Chart.contextMenu.hideContextMenu();e.Chart.content.detachEvent("mousedown",n)}:n=function(){e.Chart.contextMenu.hideContextMenu();e.Chart.content.removeEventListener("mousedown",n,!1)};e.Chart.content.onmousedown=n;e.Chart._isIE?t.cancelBubble=!0:t.stopPropagation();e.Chart._showContextMenu(t,e)};this.Chart._isIE?this.addEvent(t,"contextmenu",function(e){n(e);return!1},!1):this.addEvent(t,"contextmenu",function(e){e.preventDefault();n(e)},!1)}return t};GanttProject.prototype.getPercentCompleted=function(){var e=0,t=0;for(var n=0;n<this.Project.ParentTasks.length;n++)e+=parseInt(this.Project.ParentTasks[n].PercentCompleted);return this.Project.ParentTasks.length!=0?t=Math.round(e/this.Project.ParentTasks.length):t=-1};GanttProject.prototype.getDuration=function(){var e=0,t=0;if(this.Project.ParentTasks.length>0){for(var n=0;n<this.Project.ParentTasks.length;n++){t=this.Project.ParentTasks[n].Duration*24/this.Chart.hoursInDay+(this.Project.ParentTasks[n].EST-this.Chart.startDate)/36e5;t>e&&(e=t)}return(e-this.posX)/24*this.Chart.hoursInDay}return 0};GanttProject.prototype.getId=function(){return this.Project.Id};GanttProject.prototype.getName=function(){return this.Project.Name};GanttProject.prototype.getStartDate=function(){return this.Project.StartDate};GanttTask.prototype.addEvent=function(e,t,n,r){if(e.addEventListener){e.addEventListener(t,n,r);return!0}if(e.attachEvent)return e.attachEvent("on"+t,n);e["on"+t]=n};GanttTask.prototype.startMove=function(e){this.moveChild=e.ctrlKey;this.MouseX=e.screenX;this.getMoveInfo();this.checkMove=!0;this.Chart.isShowDescTask&&this.hideDescTask();this.Chart._isFF&&(document.body.style.cursor="move");this.Chart._isIE&&(e.srcElement.style.cursor="move")};GanttTask.prototype.showDescTask=function(){var e=parseInt(this.cTaskItem[0].style.left)+this.TaskInfo.Duration*this.Chart.hourInPixelsWork+10;this.descrTask.style.left=e+"px";this.descrTask.innerHTML=this.getDescStr();this.descrTask.style.visibility="visible"};GanttTask.prototype.hideDescTask=function(){this.descrTask.style.visibility="hidden"};GanttTask.prototype.getDescStr=function(){var e="",t=", ";for(var n=0;n<this.Chart.paramShowTask.length;n++){var r=this.Chart.paramShowTask[n],i=this.TaskInfo[r];switch(r){case"Name":e!=""&&(e+=t);e+=i;break;case"EST":e!=""&&(e+=t);e+=i.getDate()+"."+(i.getMonth()+1)+"."+i.getFullYear();break;case"S-F":e!=""&&(e+=t);i=this.TaskInfo.EST;e+=i.getDate()+"."+(i.getMonth()+1)+"."+i.getFullYear()+" - ";i=this.getFinishDate();e+=i.getDate()+"."+(i.getMonth()+1)+"."+i.getFullYear();break;case"Duration":e!=""&&(e+=t);e+=i+"h";break;case"PercentCompleted":e!=""&&(e+=t);e+=i+"%";break;default:}}return e};GanttTask.prototype.getId=function(){return this.TaskInfo.Id};GanttTask.prototype.getName=function(){return this.TaskInfo.Name};GanttTask.prototype.getDuration=function(){return this.TaskInfo.Duration};GanttTask.prototype.getEST=function(){return this.TaskInfo.EST};GanttTask.prototype.getFinishDate=function(){var e=new Date(this.TaskInfo.EST);e.setDate(e.getDate()+parseInt((this.TaskInfo.Duration-1)/this.Chart.hoursInDay+1)-1);return e};GanttTask.prototype.getPercentCompleted=function(){return this.TaskInfo.PercentCompleted};GanttTask.prototype.getPredecessorTaskId=function(){return this.TaskInfo.PredecessorTaskId?this.TaskInfo.PredecessorTaskId:null};GanttTask.prototype.getParentTaskId=function(){return this.parentTask?this.parentTask.getId():null};GanttTask.prototype.moveDescTask=function(){var e=parseInt(this.cTaskItem[0].style.left)+this.TaskInfo.Duration*this.Chart.hourInPixelsWork+10;this.descrTask.style.left=e+"px"};GanttTask.prototype.getMoveInfo=function(){this.posX=parseInt(this.cTaskItem[0].style.left);var e=parseInt(this.cTaskItem[0].childNodes[0].firstChild.width),t=this.parentTask==null?0:parseInt(this.parentTask.cTaskItem[0].style.left),n=this.predTask==null?0:parseInt(this.predTask.cTaskItem[0].style.left)+parseInt(this.predTask.cTaskItem[0].childNodes[0].firstChild.width),r=this.parentTask==null?0:parseInt(this.parentTask.cTaskItem[0].childNodes[0].firstChild.width),i=0,s=0,o=0;if(this.childPredTask.length>0){var u=null;for(var a=0;a<this.childPredTask.length;a++)if(!u||u&&u>parseInt(this.childPredTask[a].cTaskItem[0].style.left))u=parseInt(this.childPredTask[a].cTaskItem[0].style.left);i=u}if(this.childTask.length>0){var f=null;for(var a=0;a<this.childTask.length;a++)if(!f||f&&f>parseInt(this.childTask[a].cTaskItem[0].style.left))f=parseInt(this.childTask[a].cTaskItem[0].style.left);o=f;var u=null;for(var a=0;a<this.childTask.length;a++)if(!u||u&&u<parseInt(this.childTask[a].cTaskItem[0].style.left)+parseInt(this.childTask[a].cTaskItem[0].firstChild.firstChild.width))u=parseInt(this.childTask[a].cTaskItem[0].style.left)+parseInt(this.childTask[a].cTaskItem[0].firstChild.firstChild.width);s=u}if(!this.moveChild){this.childPredTask.length>0&&this.maxPosXMove<i&&(this.maxPosXMove=i);if(this.childTask.length>0){this.childPredTask.length>0&&this.maxPosXMove-e>o&&(this.maxPosXMove=this.maxPosXMove-(this.maxPosXMove-e-o));this.childPredTask.length>0||(this.maxPosXMove=o+e);this.minPosXMove=s-e}if(t>0){!(this.childPredTask.length>0)&&this.childTask.length>0&&this.maxPosXMove>t+r&&(this.maxPosXMove=t+r);this.minPosXMove<=t&&(this.minPosXMove=t);this.childTask.length>0||this.childPredTask.length>0?!(this.childTask.length>0)&&this.childPredTask.length>0&&t+r>n&&(this.maxPosXMove=i):this.maxPosXMove=t+r}n>0&&this.minPosXMove<=n&&(this.minPosXMove=n);n==0&&t==0&&this.minPosXMove<=this.Chart.initialPos&&(this.minPosXMove=this.Chart.initialPos)}else{if(t>0&&n==0){this.minPosXMove=t;this.maxPosXMove=t+r}else if(t==0&&n==0){this.minPosXMove=this.Chart.initialPos;this.maxPosXMove=-1}else if(t>0&&n>0){this.minPosXMove=n;this.maxPosXMove=t+r}else if(t==0&&n>0){this.minPosXMove=n;this.maxPosXMove=-1}if(this.parentTask&&this.childPredTask.length>0){var u=this.getMaxPosPredChildTaskItem(this),t=parseInt(this.parentTask.cTaskItem[0].style.left)+parseInt(this.parentTask.cTaskItem[0].firstChild.firstChild.width);this.maxPosXMove=this.posX+e+t-u}}};GanttTask.prototype.startResize=function(e){this.MouseX=e.screenX;this.getResizeInfo();this.Chart.isShowDescTask&&this.hideDescTask();this.checkResize=!0;this.taskItemWidth=parseInt(this.cTaskItem[0].firstChild.firstChild.width);this.Chart._isFF&&(document.body.style.cursor="e-resize")};GanttTask.prototype.getResizeInfo=function(){var e=this.cTaskItem[0],t=this.parentTask==null?0:parseInt(this.parentTask.cTaskItem[0].style.left),n=this.parentTask==null?0:parseInt(this.parentTask.cTaskItem[0].childNodes[0].firstChild.width),r=parseInt(this.cTaskItem[0].style.left),i=0,s=0;if(this.childPredTask.length>0){var o=null;for(var u=0;u<this.childPredTask.length;u++)if(!o||o&&o>parseInt(this.childPredTask[u].cTaskItem[0].style.left))o=parseInt(this.childPredTask[u].cTaskItem[0].style.left);i=o}if(this.childTask.length>0){var o=null;for(var u=0;u<this.childTask.length;u++)if(!o||o&&o<parseInt(this.childTask[u].cTaskItem[0].style.left)+parseInt(this.childTask[u].cTaskItem[0].firstChild.firstChild.width))o=parseInt(this.childTask[u].cTaskItem[0].style.left)+parseInt(this.childTask[u].cTaskItem[0].firstChild.firstChild.width);s=o}this.minWidthResize=this.Chart.dayInPixels;this.childTask.length>0&&(this.minWidthResize=s-r);if(this.childPredTask.length>0&&!this.parentTask)this.maxWidthResize=i-r;else if(this.childPredTask.length>0&&this.parentTask){var a=t+n-r,f=i-r;this.maxWidthResize=Math.min(a,f)}else this.childPredTask.length==0&&this.parentTask&&(this.maxWidthResize=t+n-r)};GanttTask.prototype.createTaskItem=function(){var e=this;this.posX=this.Chart.getPosOnDate(this.TaskInfo.EST);var t=document.createElement("div");t.id=this.TaskInfo.Id;t.style.cssText=";z-index:1;position:absolute;left:"+this.posX+"px;top:"+this.posY+"px;";var n=document.createElement("div");t.appendChild(n);n.style.cssText="z-index:1;position: absolute;left:0px;top:0px;";var r=document.createElement("table");n.appendChild(r);r.cellPadding="0";r.cellSpacing="0";r.width=this.TaskInfo.Duration*this.Chart.hourInPixelsWork+"px";r.style.cssText="border: solid 1px #6589A9;";var i=r.insertRow(r.rows.length);if(this.TaskInfo.PercentCompleted!=0){var s=document.createElement("td");i.appendChild(s);s.height=this.Chart.heightTaskItem+"px";s.width=this.TaskInfo.PercentCompleted+"%";s.style.lineHeight="1px";var o=document.createElement("img");o.style.width=this.TaskInfo.PercentCompleted*this.TaskInfo.Duration*this.Chart.hourInPixelsWork/100+"px";o.style.height=this.Chart.heightTaskItem+"px";s.appendChild(o);o.src=this.Chart.imgs+"progress_filled.png"}if(this.TaskInfo.PercentCompleted!=100){var s=document.createElement("td");i.appendChild(s);s.height=this.Chart.heightTaskItem+"px";s.width=100-this.TaskInfo.PercentCompleted+"%";s.style.lineHeight="1px";var u=document.createElement("img");u.style.width=(100-this.TaskInfo.PercentCompleted)*this.TaskInfo.Duration*this.Chart.hourInPixelsWork/100+"px";u.style.height=this.Chart.heightTaskItem+"px";s.appendChild(u);u.src=this.Chart.imgs+"progress_bg.png"}if(this.Chart.isEditable){var a=document.createElement("div");a.style.cssText="text-align:center;font-size:9px;z-index:2;position: absolute;left:0px;top:0px;";var f=document.createElement("table");a.appendChild(f);f.cellPadding="0";f.cellSpacing="0";f.height=this.Chart.heightTaskItem+"px";f.width=this.TaskInfo.Duration*this.Chart.hourInPixelsWork+"px";var l=f.insertRow(0),c=document.createElement("TD");c.align="center";c.vAlign="top";c.height=this.Chart.heightTaskItem+"px";c.className="moveInfo";c.style.cssText=";white-space:nowrap;font-size:9px";l.appendChild(c);t.appendChild(a)}var h=document.createElement("div");t.appendChild(h);h.style.cssText=";z-index:2;position: absolute;left:0px;top:0px;";var p=document.createElement("div");p.innerHTML="<input type='text' style='visibility:hidden;width:1px;height:1px;'/>";if(this.Chart._isIE){p.style.background="#000000";p.style.filter="alpha(opacity=0)"}p.style.height=this.Chart.heightTaskItem+"px";p.style.width=this.TaskInfo.Duration*this.Chart.hourInPixelsWork+"px";h.appendChild(p);if(this.Chart._showTooltip){var d=function(t){!e.Chart._isMove&&!e.Chart._isResize&&e.getPopUpInfo(e.cTaskItem[0],t)},v=function(){e.closePopUpInfo()};this.addEvent(p,"mouseover",d,!1);this.addEvent(p,"mouseout",v,!1)}var m=function(){e.Chart.callEvent("onTaskClick",[e])};this.addEvent(p,"click",m,!1);if(this.Chart.isEditable){var g=document.createElement("div");g.style.cssText=";z-index:10;position: absolute;left:"+(this.TaskInfo.Duration*this.Chart.hourInPixelsWork-10)+"px;top:0px;";g.style.height=this.Chart.heightTaskItem+"px";g.style.width="10px";g.innerHTML="<input type='text' style='visibility:hidden;width:1px;height:1px;'/>";h.appendChild(g);var y=function(t){if(e.Chart.callEvent("onTaskStartDrag",[e])===!1)return;var n=function(t){e.checkMove&&e.moveItem(t)},r=function(){if(e.checkMove){e.endMove();e.Chart._isMove=!1;if(e.Chart._isIE){document.body.releaseCapture();document.detachEvent("onmousemove",n);document.detachEvent("onmouseup",r)}else{document.removeEventListener("mousemove",n,!0);document.removeEventListener("mouseup",r,!0)}e.wasMoved&&e.Chart.callEvent("onTaskEndDrag",[e])}};e.addEvent(document,"mousemove",n,!0);e.addEvent(document,"mouseup",r,!0);e.Chart._showTooltip&&e.closePopUpInfo();e.startMove(t);e.Chart._isMove=!0;e.Chart._isIE&&document.body.setCapture(!1)},b=function(t){if(e.Chart.callEvent("onTaskStartResize",[e])===!1)return;var n=function(t){e.checkResize&&e.resizeItem(t)},r=function(){if(e.checkResize){e.endResizeItem();e.Chart._isResize=!1;if(e.Chart._isIE){document.body.releaseCapture();document.detachEvent("onmousemove",n);document.detachEvent("onmouseup",r)}else{document.removeEventListener("mousemove",n,!0);document.removeEventListener("mouseup",r,!0)}e.wasResized&&e.Chart.callEvent("onTaskEndResize",[e])}};e.addEvent(document,"mousemove",n,!1);e.addEvent(document,"mouseup",r,!1);e.startResize(t);e.Chart._isIE&&document.body.setCapture(!1);e.Chart._isResize=!0};this.addEvent(p,"mousedown",y,!1);this.addEvent(g,"mousedown",b,!1);var w=function(t){e.Chart._isMove||((t.srcElement?t.srcElement:t.target).style.cursor="e-resize")},E=function(t){e.checkResize||((t.srcElement?t.srcElement:t.target).style.cursor="")};this.addEvent(g,"mouseover",w,!1);this.addEvent(g,"mouseout",E,!1)}return t};GanttTask.prototype.createTaskNameItem=function(e){var t=this,n=document.createElement("div");n.id=this.TaskInfo.Id;n.style.cssText="cursor:pointer;white-space:nowrap;height:15px;z-index:1;position:absolute;left:20px;top: "+this.posY+"px;";e&&(n.style.fontWeight="bold");n.className="taskNameItem";n.title=this.TaskInfo.Name;n.innerHTML=this.TaskInfo.Name;if(this.Chart.isShowConMenu){var r=function(e){t.Chart.contextMenu.clear&&t.Chart.contextMenu.clear();var n=function(){t.Chart.contextMenu.hideContextMenu();t.Chart._isIE?t.Chart.content.detachEvent("mousedown",n):t.Chart.content.removeEventListener("mousedown",n,!1)};t.Chart.content.onmousedown=n;t.Chart._isIE?e.cancelBubble=!0:e.stopPropagation();t.Chart._showContextMenu(e,t)};this.Chart._isIE?this.addEvent(n,"contextmenu",function(e){r(e);return!1},!1):this.addEvent(n,"contextmenu",function(e){e.preventDefault();r(e)},!1)}return n};GanttTask.prototype.createTaskDescItem=function(){var e=this.posX+this.TaskInfo.Duration*this.Chart.hourInPixelsWork+10,t=document.createElement("div");t.style.cssText+=";z-index:1;position:absolute;left:"+e+"px;top:"+this.posY+"px;";t.innerHTML=this.getDescStr();t.className="descTask";this.descrTask=t;if(this.Chart._showTooltip){var n=this,r=function(e){!n.Chart._isMove&&!n.Chart._isResize&&n.getPopUpInfo(n.descrTask,e)},i=function(){n.closePopUpInfo()};this.addEvent(t,"mouseover",r,!1);this.addEvent(t,"mouseout",i,!1)}return t};GanttTask.prototype.checkWidthTaskNameItem=function(){if(this.cTaskNameItem[0].offsetWidth+this.cTaskNameItem[0].offsetLeft>this.Chart.maxWidthPanelNames){var e=this.cTaskNameItem[0].offsetWidth+this.cTaskNameItem[0].offsetLeft-this.Chart.maxWidthPanelNames,t=Math.round(e/(this.cTaskNameItem[0].offsetWidth/this.cTaskNameItem[0].firstChild.length)),n=this.TaskInfo.Name.substring(0,this.cTaskNameItem[0].firstChild.length-t-3);n+="...";this.cTaskNameItem[0].innerHTML=n}};GanttTask.prototype.create=function(){var e=this.Chart.oData.firstChild,t=null;this.Chart._showTreePanel&&(t=this.Chart.panelNames.firstChild);var n=this.TaskInfo.PredecessorTask,r=this.TaskInfo.ParentTask,i=this.TaskInfo.ChildTasks.length>0,s=this;this.cTaskItem=[];this.cTaskNameItem=[];if(!r)if(this.TaskInfo.previousParentTask){this.previousParentTask=this.Project.getTaskById(this.TaskInfo.previousParentTask.Id);var o=this.Chart.getLastChildTask(this.previousParentTask);this.posY=parseInt(o.cTaskItem[0].style.top)+this.Chart.heightTaskItem+11;this.previousParentTask.nextParentTask=this}else this.posY=parseInt(this.Project.projectItem[0].style.top)+this.Chart.heightTaskItem+11;if(r){var u=this.Project.getTaskById(this.TaskInfo.ParentTask.Id);this.parentTask=u;if(this.TaskInfo.previousChildTask){this.previousChildTask=this.Project.getTaskById(this.TaskInfo.previousChildTask.Id);var o=this.Chart.getLastChildTask(this.previousChildTask);this.posY=parseInt(o.cTaskItem[0].style.top)+this.Chart.heightTaskItem+11;this.previousChildTask.nextChildTask=this}else this.posY=parseInt(u.cTaskItem[0].style.top)+this.Chart.heightTaskItem+11;u.childTask.push(this)}if(n){var u=this.Project.getTaskById(n.Id);this.predTask=u;u.childPredTask.push(this)}this.cTaskItem.push(this.createTaskItem());e.appendChild(this.cTaskItem[0]);if(this.Chart.panelNames){this.cTaskNameItem.push(this.createTaskNameItem(i));this.Chart.panelNames.firstChild.appendChild(this.cTaskNameItem[0])}this.Chart.isShowDescTask&&e.appendChild(this.createTaskDescItem());var a=[];n&&(a=this.createConnectingLinesDS());this.cTaskItem.push(a);if(this.Chart.panelNames){var f=[];if(r){this.cTaskNameItem[0].style.left=parseInt(this.parentTask.cTaskNameItem[0].style.left)+15+"px";f=this.createConnectingLinesPN()}this.checkWidthTaskNameItem();var l=null;i&&(l=this.createTreeImg());this.cTaskNameItem.push(f);this.cTaskNameItem.push(l)}this.addDayInPanelTime();return this};GanttTask.prototype.createTreeImg=function(){var e=this,t=new Image;t.src=this.Chart.imgs+"minus.gif";t.id=this.TaskInfo.Id;t.onclick=function(){if(e._isOpen){this.src=e.Chart.imgs+"plus.gif";e._isOpen=!1;e.hideChildTasks(e);e.shiftCurrentTasks(e,-e._heightHideTasks)}else{this.src=e.Chart.imgs+"minus.gif";e._isOpen=!0;e.shiftCurrentTasks(e,e._heightHideTasks);e.showChildTasks(e,!0);e._heightHideTasks=0}};this.Chart.panelNames.firstChild.appendChild(t);t.style.cssText="cursor:pointer;left:"+(parseInt(this.cTaskNameItem[0].style.left)-12)+"px;top:"+(parseInt(this.cTaskNameItem[0].style.top)+3)+"px;z-index:12;position:absolute;";return t};GanttChart.prototype.getLastChildTask=function(e){return e.childTask.length>0?this.getLastChildTask(e.childTask[e.childTask.length-1]):e};dhtmlXMLSenderObject=function(e){this.xmlHttp=this.createXMLHttpRequest();this.isProcessed=!1;this.path=null;this.filename=null;this.Chart=e};dhtmlXMLSenderObject.prototype.createXMLHttpRequest=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject)return new ActiveXObject("Microsoft.XMLHTTP")};dhtmlXMLSenderObject.prototype.sendData=function(e,t,n){var r=this;this.path=t;this.filename=e;if(this.path==null||this.path==""){this.Chart.Error.throwError("DATA_SEND_ERROR",3,null);return}if(this.filename==null||this.filename==""){this.Chart.Error.throwError("DATA_SEND_ERROR",4,null);return}this.isProcessed=!0;this.xmlHttp.open("POST",this.path,!0);this.Chart._isFF&&(this.xmlHttp.onerror=function(){r.xmlHttp.onreadystatechange=null;r.xmlHttp.abort();r.isProcessed=!1});this.xmlHttp.onreadystatechange=function(){r.getStatus()};this.xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");this.xmlHttp.send("data="+encodeURI(n)+"&filename="+e)};dhtmlXMLSenderObject.prototype.getStatus=function(){if(this.xmlHttp.readyState==4){var e="";try{e=this.xmlHttp.status}catch(t){this.Chart.Error.throwError("DATA_SEND_ERROR",1,null);return 0}switch(e){case 0:this.Chart.Error.throwError("DATA_SEND_ERROR",1,null);break;case 404:this.Chart.Error.throwError("DATA_SEND_ERROR",5,[this.path]);break;case 500:this.Chart.Error.throwError("DATA_SEND_ERROR",2,null);break;case 12029:this.Chart.Error.throwError("DATA_SEND_ERROR",1,null);break;default:e>=200&&e<300||e==304||this.Chart.Error.throwError("DATA_SEND_ERROR",0,null)}this.isProcessed=!1}};GanttError.prototype._init=function(){this._errors[0]="Connection error";this._errors[1]="Cannot connect";this._errors[2]="Server error";this._errors[3]="Path is null or empty";this._errors[4]="Filename is null or empty";this._errors[5]="File (%0) is not found";this._errors[6]="Percent Complete  should be a number";this._errors[7]="Percent Complete should be <= 100";this._errors[8]="Percent Complete should be >= 0";this._errors[9]="Increase duration of task(%0)";this._errors[10]="Reduce duration of task(%0)";this._errors[11]="Increase  EST of child task (%0)";this._errors[12]="Reduce EST of task (%0)";this._errors[13]="The project (%0) is added";this._errors[14]="Start Date of the project < start Date of the control";this._errors[15]="Task (%0) cannot be the child of predecessor task(%1)";this._errors[16]="Time of the termination of predecessor task(%0) > EST of child task(%1)";this._errors[17]="The Predecessor (%0) task  does not exist";this._errors[18]="The EST of task (%0) < start date of the control";this._errors[19]="Time of the termination of parent task (%0) < time of the termination of child task(%1)";this._errors[20]="The EST of task (%0) < EST of parent task(%1)";this._errors[21]="The parent task (%0) does not exist";this._errors[22]="The task (%0) is added";this._errors[23]="The project (%0) is added";this._errors[24]="Task (%0) EST < project (%1) startDate";this._errors[25]="Parent task (%0) EST cannot be null";this._errors[26]="Predecessor task (%0) position error. Reduce duration of predecessor task (%0) or increase EST of child task (%1)";this._errors[27]="Predecessor task (%0) does not exist";this._errors[28]="Increase duration of parent task (%0) or reduce EST of child task (%1) or reduce duration of child task(%1)";this._errors[29]="Reduce EST of parent task (%0) or increase  EST of child task (%1)";this._errors[30]="The  task(%0) does not exist";this._errors[31]="The project(%0) does not exist";this._errors[32]="Predecessor task(%0) and child task(%1) should have the same parent";this._errors[33]="Reduce EST of parent task (%0) or increase  EST of child task (%1)";this._errors[34]="EST of task(%0) < start date of the project(%1)"
;this._errors[35]="Percent Complete should be <= 100 and >= 0";this._errors[36]="You may not connect a task to itself.";this._errors[37]="Cannot parse this XML string."};GanttError.prototype.catchError=function(e,t){this.catches[e]=t};GanttError.prototype.getErrorString=function(e,t){if(!t)return e;for(var n=0;n<t.length;n++){var r=new RegExp("%"+n,"gi");e=e.replace(r,t[n])}return e};GanttError.prototype.throwError=function(e,t,n){if(this.catches[e]){var r=parseInt(t),i=this.getErrorString(this._errors[r],n);return this.catches[e](e,i,n)}return null};contextMenu.prototype._init=function(){this.createMenuPanel();this.createHideDiv();this.createTabContainer();this.createTabPanel();var e=this,t=[],n=this.createTab(1,"Rename task","t",!0,this);n.addItem(1,"New name",document.createElement("input"),"text",function(){n.arrItems[0].control.focus()});n.addItem(2,"Rename",document.createElement("input"),"button",function(){var e=n.arrItems[0].control.value;try{n.object.setName(e);n.hide()}catch(t){}});var r=this.createTab(2,"Delete task","t",!0,this);r.addItem(1,"Delete",document.createElement("input"),"button",function(){try{r.object.Project.deleteTask(r.object.TaskInfo.Id);r.hide()}catch(e){}});var i=this.createTab(3,"Set EST","t",!0,this);i.addItem(1,"EST",document.createElement("input"),"text",function(){i.arrItems[0].control.focus()});i.addItem(2,"Move children",document.createElement("input"),"checkbox",function(){i.arrItems[1].control.focus()});i.addItem(3,"Update",document.createElement("input"),"button",function(){var e=i.arrItems[1].control.checked,t=i.arrItems[0].control.value.split("."),n=t.length<3?null:new Date(t[2],parseInt(t[1])-1,t[0]);try{i.object.setEST(n,e)&&i.hide()}catch(r){}});var s=this.createTab(4,"Set duration","t",!0,this);s.addItem(1,"Duration",document.createElement("input"),"text",function(){s.arrItems[0].control.focus()});s.addItem(2,"Update",document.createElement("input"),"button",function(){var e=s.arrItems[0].control.value;try{s.object.setDuration(e)&&s.hide()}catch(t){}});var o=this.createTab(5,"Set % complete","t",!0,this);o.addItem(1,"Percent Complete",document.createElement("input"),"text",function(){o.arrItems[0].control.focus()});o.addItem(2,"Update",document.createElement("input"),"button",function(){var e=o.arrItems[0].control.value;try{o.object.setPercentCompleted(e)&&o.hide()}catch(t){}});var u=this.createTab(13,"Set predecessor","t",!0,this);u.addItem(1,"Predecessor",document.createElement("input"),"text",function(){u.arrItems[0].control.focus()});u.addItem(2,"Update",document.createElement("input"),"button",function(){var e=u.arrItems[0].control.value;try{u.object.setPredecessor(e)&&u.hide()}catch(t){}});var a=this.createTab(6,"Rename project","p",!0,this);a.addItem(1,"New name",document.createElement("input"),"text",function(){a.arrItems[0].control.focus()});a.addItem(2,"Rename",document.createElement("input"),"button",function(){var e=a.arrItems[0].control.value;try{a.object.setName(e);a.hide()}catch(t){}});var f=this.createTab(7,"Delete project","p",!0,this);f.addItem(1,"Delete",document.createElement("input"),"button",function(){try{f.object.Chart.deleteProject(f.object.Project.Id);f.hide()}catch(e){}});var l=this.createTab(8,"Set % complete","p",!0,this);l.addItem(1,"Percent Complete",document.createElement("input"),"text",function(){l.arrItems[0].control.focus()});l.addItem(2,"Update",document.createElement("input"),"button",function(){var e=l.arrItems[0].control.value;try{l.object.setPercentCompleted(e)&&l.hide()}catch(t){}});var c=this.createTab(9,"Add new task","p",!0,this);c.addItem(1,"Id",document.createElement("input"),"text",function(){c.arrItems[0].control.focus()});c.addItem(2,"Name",document.createElement("input"),"text",function(){c.arrItems[1].control.focus()});c.addItem(3,"EST",document.createElement("input"),"text",function(){c.arrItems[2].control.focus()});c.addItem(4,"Duration",document.createElement("input"),"text",function(){c.arrItems[3].control.focus()});c.addItem(5,"Percent complete",document.createElement("input"),"text",function(){c.arrItems[4].control.focus()});c.addItem(6,"Parent task id",document.createElement("input"),"text",function(){c.arrItems[5].control.focus()});c.addItem(7,"Pred task id",document.createElement("input"),"text",function(){c.arrItems[6].control.focus()});c.addItem(9,"Insert",document.createElement("input"),"button",function(){try{var e=c.arrItems[0].control.value,t=c.arrItems[1].control.value,n=c.arrItems[2].control.value.split("."),r=n.length<3?null:new Date(n[2],parseInt(n[1])-1,n[0]),i=c.arrItems[3].control.value,s=c.arrItems[4].control.value,o=c.arrItems[5].control.value,u=c.arrItems[6].control.value;c.object.insertTask(e,t,r,i,s,u,o)&&c.hide()}catch(a){}});var h=this.createTab(11,"Add successor task","t",!0,this);h.addItem(1,"Id",document.createElement("input"),"text",function(){h.arrItems[0].control.focus()});h.addItem(2,"Name",document.createElement("input"),"text",function(){h.arrItems[1].control.focus()});h.addItem(3,"EST",document.createElement("input"),"text",function(){h.arrItems[2].control.focus()});h.addItem(4,"Duration",document.createElement("input"),"text",function(){h.arrItems[3].control.focus()});h.addItem(5,"Percent complete",document.createElement("input"),"text",function(){h.arrItems[4].control.focus()});h.addItem(6,"Insert",document.createElement("input"),"button",function(){try{var e=h.object.Project,t=h.arrItems[0].control.value,n=h.arrItems[1].control.value,r=h.arrItems[2].control.value.split("."),i=r.length<3?null:new Date(r[2],parseInt(r[1])-1,r[0]),s=h.arrItems[3].control.value,o=h.arrItems[4].control.value,u=h.object.parentTask==null?"":h.object.parentTask.TaskInfo.Id,a=h.object.TaskInfo.Id;e.insertTask(t,n,i,s,o,a,u)&&h.hide()}catch(f){}});var p=this.createTab(10,"Add child task","t",!0,this);p.addItem(1,"Id",document.createElement("input"),"text",function(){p.arrItems[0].control.focus()});p.addItem(2,"Name",document.createElement("input"),"text",function(){p.arrItems[1].control.focus()});p.addItem(3,"EST",document.createElement("input"),"text",function(){p.arrItems[2].control.focus()});p.addItem(4,"Duration",document.createElement("input"),"text",function(){p.arrItems[3].control.focus()});p.addItem(5,"Percent complete",document.createElement("input"),"text",function(){p.arrItems[4].control.focus()});p.addItem(6,"Insert",document.createElement("input"),"button",function(){try{var e=p.object.Project,t=p.arrItems[0].control.value,n=p.arrItems[1].control.value,r=p.arrItems[2].control.value.split("."),i=r.length<3?null:new Date(r[2],parseInt(r[1])-1,r[0]),s=p.arrItems[3].control.value,o=p.arrItems[4].control.value,u=p.object.TaskInfo.Id,a="";e.insertTask(t,n,i,s,o,a,u)&&p.hide()}catch(f){}});var d=this.createTab(12,"-Insert new project-","p",!1,this);d.addItem(1,"Id",document.createElement("input"),"text",function(){d.arrItems[0].control.focus()});d.addItem(2,"Name",document.createElement("input"),"text",function(){d.arrItems[1].control.focus()});d.addItem(3,"Start date",document.createElement("input"),"text",function(){d.arrItems[2].control.focus()});d.addItem(4,"Insert",document.createElement("input"),"button",function(){try{var t=d.arrItems[0].control.value,n=d.arrItems[1].control.value,r=d.arrItems[2].control.value.split("."),i=r.length<3?null:new Date(r[2],parseInt(r[1])-1,r[0]);e.Chart.insertProject(t,n,i)&&d.hide()}catch(s){}})};contextMenu.prototype.createHideDiv=function(){this.hideDiv=document.createElement("div");this.hideDiv.style.position="absolute";this.hideDiv.style.left="0px";this.hideDiv.style.top="0px";this.Chart.content.appendChild(this.hideDiv);this.hideDiv.style.zIndex=12;this.hideDiv.style.display="none";this.hideDiv.style.background="#7D7E7D";this.hideDiv.style.cssText+=";-moz-opacity: 0.5;filter: alpha(opacity=50);opacity:.50;";this.hideDiv.style.width=this.Chart.content.offsetWidth+2+"px";this.hideDiv.style.height=this.Chart.content.offsetHeight+2+"px"};contextMenu.prototype.createMenuPanel=function(){this.MenuPanel=document.createElement("div");this.MenuPanel.style.visibility="hidden";this.MenuPanel.style.cssText+=";z-index:10;";this.MenuPanel.style.position="absolute";this.Chart.content.appendChild(this.MenuPanel);this.MenuPanel.innerHTML="<table></table>";this.MenuPanel.firstChild.className="contextMenu";this.MenuPanel.firstChild.cellPadding=0;this.MenuPanel.firstChild.cellSpacing=0;this.MenuPanel.firstChild.style.cssText+=";background:url("+this.Chart.imgs+"menu/menu_bg.png);"};contextMenu.prototype.createTabPanel=function(){this.tabPanel=document.createElement("div");this.tabPanel.style.visibility="hidden";this.tabPanel.style.zIndex="30";this.TabContainer.firstChild.rows[0].cells[0].appendChild(this.tabPanel);this.tabPanel.style.width="385px";this.tabPanel.style.height="290px";this.tabPanel.innerHTML="<table><tr><td></td></tr><tr><td></td></tr></table>";this.tabPanel.firstChild.cellPadding=0;this.tabPanel.firstChild.cellSpacing=0;this.tabPanel.firstChild.style.cssText="width:385px;border: 1px solid #808080;";this.tabPanel.firstChild.rows[0].cells[0].style.cssText=";height:26px;background:url("+this.Chart.imgs+"/menu/window_tr.png);background-repeat: no-repeat;color:#fff;font-size:14px;font-weight: bold;font-family: Tahoma, Arial";this.tabPanel.firstChild.rows[0].cells[0].align="center";this.tabPanel.firstChild.rows[1].cells[0].style.cssText=";height:270px;background:#F7F7F7;";this.tabPanel.firstChild.rows[1].cells[0].innerHTML="<table></table>";this.tabPanel.firstChild.rows[1].cells[0].firstChild.style.cssText="width:250px;font-size:11px;font-family:Tahoma,Arial;";this.tabPanel.firstChild.rows[1].cells[0].align="center"};contextMenu.prototype.addItemMenuPanel=function(e){var t=this,n=this.MenuPanel.firstChild.insertRow(this.MenuPanel.firstChild.rows.length),r=document.createElement("td");r.innerHTML=e.Description;r.style.cssText="padding-left:10px;height:18px;";this.addEvent(r,"mousedown",function(){e.show()},!1);r.onmouseover=function(){this.style.background="url("+t.Chart.imgs+"menu/menu_selection.png)"};r.onmouseout=function(){this.style.background=""};n.appendChild(r)};contextMenu.prototype.showContextMenu=function(e,t,n){if(n.constructor==GanttTask){for(var r=0;r<this.arrTabs.length;r++)if(this.arrTabs[r].type=="t"){this.arrTabs[r].object=n;this.addItemMenuPanel(this.arrTabs[r])}}else if(n.constructor==GanttProject)for(var r=0;r<this.arrTabs.length;r++)if(this.arrTabs[r].type=="p"){this.arrTabs[r].object=n;this.addItemMenuPanel(this.arrTabs[r])}this.isShow=!0;this.MenuPanel.style.cssText+=";z-index:15;";this.MenuPanel.style.visibility="visible";this.MenuPanel.style.top=parseInt(t)+this.Chart.heightTaskItem-this.Chart.oData.scrollTop+5+"px";this.MenuPanel.style.left=e};contextMenu.prototype.hideContextMenu=function(){this.isShow=!1;this.MenuPanel.style.visibility="hidden"};contextMenu.prototype.clear=function(){this.MenuPanel.removeChild(this.MenuPanel.firstChild);this.MenuPanel.innerHTML="<table></table>";this.MenuPanel.firstChild.className="contextMenu";this.MenuPanel.firstChild.cellPadding=0;this.MenuPanel.firstChild.cellSpacing=0;this.MenuPanel.firstChild.style.cssText+=";background:url("+this.Chart.imgs+"menu/menu_bg.png);"};contextMenu.prototype.createTab=function(e,t,n,r,i){var s=new contextMenuTab(e,t,n,r,i);this.arrTabs.push(s);return s};contextMenu.prototype.createTabContainer=function(){this.TabContainer=document.createElement("div");this.TabContainer.style.position="absolute";this.TabContainer.style.top="0px";this.TabContainer.style.left="0px";this.TabContainer.style.visibility="hidden";this.TabContainer.style.zIndex="50";this.Chart.content.appendChild(this.TabContainer);this.TabContainer.innerHTML="<table><tr><td></td></tr></table>";this.TabContainer.firstChild.style.cssText=";width:100%;height:100%;";this.TabContainer.firstChild.rows[0].cells[0].align="center";this.TabContainer.style.width=this.Chart.content.offsetWidth+2+"px";this.TabContainer.style.height=this.Chart.content.offsetHeight+2+"px"};contextMenu.prototype.getTabById=function(e){for(var t=0;t<this.arrTabs.length;t++)if(this.arrTabs[t].Id==e)return this.arrTabs[t];return null};contextMenu.prototype.addEvent=function(e,t,n,r){if(e.addEventListener){e.addEventListener(t,n,r);return!0}if(e.attachEvent)return e.attachEvent("on"+t,n);e["on"+t]=n};contextMenuTab.prototype.addItem=function(e,t,n,r,i){i&&(n.onclick=i);n.type=r;r=="button"&&(n.value=t);var s=new contextMenuTabItem(e,t,n,this);this.arrItems.push(s)};contextMenuTab.prototype.show=function(){this.contextMenu.hideDiv.style.display="inline";this.contextMenu.TabContainer.style.visibility="visible";var e=this;this.contextMenu.tabPanel.firstChild.rows[0].cells[0].innerHTML=this.Description;this.contextMenu.tabPanel.style.visibility="visible";var t=this.contextMenu.tabPanel.firstChild.rows[1].cells[0].firstChild,n,r,i=null;if(this.showObjectInfo&&this.object)if(this.object.constructor==GanttTask){this.insertData(t,"Id",this.object.TaskInfo.Id);this.insertData(t,"Name",this.object.TaskInfo.Name);this.insertData(t,"Duration",this.object.TaskInfo.Duration+" hrs");this.insertData(t,"Percent complete",this.object.TaskInfo.PercentCompleted+"%");this.insertData(t,"EST",this.object.TaskInfo.EST.getDate()+"."+(this.object.TaskInfo.EST.getMonth()+1)+"."+this.object.TaskInfo.EST.getFullYear());this.insertData(t,"Predecessor",this.object.TaskInfo.PredecessorTaskId)}else{this.insertData(t,"Id",this.object.Project.Id);this.insertData(t,"Name",this.object.Project.Name);this.insertData(t,"Start date",this.object.Project.StartDate.getDate()+"."+(this.object.Project.StartDate.getMonth()+1)+"."+this.object.Project.StartDate.getFullYear())}var s=null;for(var o=0;o<this.arrItems.length;o++)if(this.arrItems[o].control.type=="button"){i=t.insertRow(t.rows.length);n=i.insertCell(i.cells.length);s=i.insertCell(i.cells.length);s.appendChild(this.arrItems[o].control)}else{i=t.insertRow(t.rows.length);n=i.insertCell(i.cells.length);r=i.insertCell(i.cells.length);n.innerHTML=this.arrItems[o].Name;r.appendChild(this.arrItems[o].control)}var u=document.createElement("input");u.type="button";u.value="Cancel";u.onclick=function(){e.hide()};if(!s){i=t.insertRow(t.rows.length);n=i.insertCell(i.cells.length);s=i.insertCell(i.cells.length)}else u.style.marginLeft="10px";s.appendChild(u)};contextMenuTab.prototype.hide=function(){this.contextMenu.tabPanel.style.visibility="hidden";var e=this.contextMenu.tabPanel.firstChild.rows[1].cells[0].firstChild;e.parentNode.removeChild(e);this.contextMenu.tabPanel.firstChild.rows[1].cells[0].innerHTML="<table></table>";this.contextMenu.tabPanel.firstChild.rows[1].cells[0].firstChild.style.cssText="width:250px;font-size:11px;font-family:Tahoma,Arial;";this.contextMenu.hideDiv.style.display="none";this.contextMenu.TabContainer.style.visibility="hidden"};contextMenuTab.prototype.insertData=function(e,t,n){var r,i,s=null;s=e.insertRow(e.rows.length);r=s.insertCell(s.cells.length);r.style.cssText="width:100px";r.innerHTML=t;i=s.insertCell(s.cells.length);i.innerHTML=n};contextMenuTab.prototype.insertControl=function(e,t,n){var r,i,s=null;s=e.insertRow(e.rows.length);r=s.insertCell(s.cells.length);r.innerHTML=t;i=s.insertCell(s.cells.length);i.appendChild(n)};